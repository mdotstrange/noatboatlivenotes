<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>try again - Noat Boat</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f2f2f2; color: #111; height: 100vh; display: flex; flex-direction: column; }
    .topbar { display: flex; align-items: center; padding: 10px 14px; border-bottom: 1px solid #d9d9d9; background: #ffffff; gap: 12px; }
    .back-btn { padding: 6px 12px; border: 1px solid #d9d9d9; background: #ffffff; border-radius: 6px; cursor: pointer; font-size: 13px; color: #111; text-decoration: none; }
    .title { font-size: 16px; font-weight: 700; font-family: monospace; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .save-status { font-size: 12px; color: #666; font-family: monospace; }
    .main { display: flex; flex: 1; overflow: hidden; gap: 16px; padding: 14px; min-height: 0; }
    .editor-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; min-height: 0; }
    textarea { flex: 1; border: 1px solid #d9d9d9; border-radius: 12px; resize: none; padding: 14px; font-size: 14px; line-height: 1.55; font-family: monospace; background: #fff; color: #111; outline: none; }
    .canvas-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; min-height: 0; border: 1px solid #d9d9d9; border-radius: 12px; overflow: hidden; background: #fff; }
    .canvas-toolbar { display: flex; gap: 6px; padding: 8px 10px; border-bottom: 1px solid #d9d9d9; background: #ffffff; flex-shrink: 0; }
    .btn { padding: 5px 10px; border: 1px solid #d9d9d9; background: #ffffff; border-radius: 6px; cursor: pointer; font-size: 12px; color: #111; }
    .btn.active { background: #eef5ff; border-color: #c9dcff; }
    #canvasContainer { flex: 1; position: relative; overflow: hidden; min-height: 0; display: flex; align-items: center; justify-content: center; }
    .canvas-wrapper { transform-origin: center center; display: inline-block; }
    .audio-player { padding: 10px; border-top: 1px solid #d9d9d9; display: none; flex-shrink: 0; }
    .audio-player audio { width: 100%; }
    @media (max-width: 768px) { .main { flex-direction: column; } .editor-pane, .canvas-pane { flex: none; height: 45vh; } }
  </style>
</head>
<body>
  <div class="topbar">
    <a href="../index.html" class="back-btn">Back</a>
    <div class="title">try again</div>
    <div class="save-status" id="saveStatus"></div>
  </div>
  <div class="main">
    <div class="editor-pane">
      <textarea id="editor" spellcheck="false">lets try aain</textarea>
    </div>
    <div class="canvas-pane" id="canvasPane">
      <div class="canvas-toolbar">
        <button id="selectBtn" class="btn active">Select</button>
        <button id="drawBtn" class="btn">Draw</button>
      </div>
      <div id="canvasContainer">
        <div class="canvas-wrapper" id="canvasWrapper">
          <canvas id="fabricCanvas"></canvas>
        </div>
      </div>
      <div class="audio-player"><audio controls loop src=""></audio></div>
    </div>
  </div>
  <script>
    (function() {
      var STORAGE_KEY = 'noatboat_' + "try-again";
      var canvasJson = "{\"version\":\"5.3.0\",\"objects\":[{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":286.18,\"top\":531.54,\"width\":672.2,\"height\":796.24,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",703.810124361397,533.0365824186323],[\"Q\",703.807124361397,533.0365824186323,702.8068210978142,533.0365824186323],[\"Q\",701.8065178342315,533.0365824186323,700.8062145706488,533.0365824186323],[\"Q\",699.8059113070661,533.0365824186323,694.8043949891526,533.0365824186323],[\"Q\",689.802878671239,533.0365824186323,678.7995427718292,533.0365824186323],[\"Q\",667.7962068724194,533.0365824186323,656.7928709730096,533.0365824186323],[\"Q\",645.7895350735998,533.0365824186323,632.7855926470246,533.0365824186323],[\"Q\",619.7816502204494,533.0365824186323,606.7777077938741,533.0365824186323],[\"Q\",593.7737653672989,533.0365824186323,580.7698229407237,536.0374921014959],[\"Q\",567.7658805141484,539.0384017843594,552.7613315604078,546.0405243777076],[\"Q\",537.7567826066671,553.0426469710558,520.751627125761,563.0456792472676],[\"Q\",503.74647164485503,573.0487115234793,484.74070963678355,586.0526534825544],[\"Q\",465.7349476287121,599.0565954416297,446.72918562064064,617.0620535388108],[\"Q\",427.72342361256915,635.0675116359919,403.71614528658415,669.0778213751117],[\"Q\",379.7088669605991,703.0881311142316,353.7009821074487,754.1035957229115],[\"Q\",327.6930972542982,805.1190603315912,313.68885156414024,861.1360410783768],[\"Q\",299.6846058739823,917.1530218251626,294.6830895560688,972.169699344327],[\"Q\",289.68157323815524,1027.1863768634914,288.6812699745725,1072.2000221064443],[\"Q\",287.6809667109898,1117.2136673493972,287.6809667109898,1155.2251899990017],[\"Q\",287.6809667109898,1193.2367126486063,291.68217976532065,1215.243383656272],[\"Q\",295.6833928196515,1237.2500546639378,302.6855156647305,1247.2530869401494],[\"Q\",309.6876385098094,1257.2561192163612,314.689154827723,1261.257332126846],[\"Q\",319.69067114563654,1265.2585450373306,323.6918841999674,1267.259151492573],[\"Q\",327.6930972542982,1269.2597579478154,340.69703968087344,1273.2609708583],[\"Q\",353.7009821074486,1277.2621837687846,375.7076539062682,1284.2643063621329],[\"Q\",397.71432570508784,1291.2664289554812,429.7240301397345,1298.2685515488292],[\"Q\",461.73373457438123,1305.2706741421775,504.7467749084377,1310.2721902802832],[\"Q\",547.7598152424943,1315.273706418389,592.7734621037162,1319.2749193288737],[\"Q\",637.787108964938,1323.2761322393585,678.7995427718292,1325.276738694601],[\"Q\",719.8119765787203,1327.2773451498433,748.8207712226189,1328.2776483774646],[\"Q\",777.8295658665174,1329.2779516050857,794.8347213474235,1329.2779516050857],[\"Q\",811.8398768283296,1329.2779516050857,823.8435159913221,1329.2779516050857],[\"Q\",835.8471551543146,1329.2779516050857,842.8492779993935,1329.2779516050857],[\"Q\",849.8514008444726,1329.2779516050857,853.8526138988034,1328.2776483774646],[\"Q\",857.8538269531342,1327.2773451498433,859.8544334802996,1326.277041922222],[\"Q\",861.855040007465,1325.276738694601,863.8556465346305,1323.2761322393585],[\"Q\",865.8562530617959,1321.2755257841163,867.8568595889612,1317.2743128736315],[\"Q\",869.8574661161267,1313.273099963147,872.8583759068748,1306.2709773697989],[\"Q\",875.8592856976229,1299.2688547764506,880.8608020155365,1284.264306362133],[\"Q\",885.86231833345,1269.2597579478154,892.864441178529,1242.2515708020437],[\"Q\",899.866564023608,1215.243383656272,909.869596659435,1174.2309513238038],[\"Q\",919.8726292952622,1133.2185189913357,928.8753586675066,1089.2051769760042],[\"Q\",937.8780880397509,1045.1918349606726,943.8799076212472,1008.1806155386893],[\"Q\",949.8817272027434,971.1693961167059,952.8826369934916,939.1596928328283],[\"Q\",955.8835467842397,907.1499895489509,957.884153311405,880.1418024031792],[\"Q\",959.8847598385705,853.1336152574075,959.8847598385705,831.1269442497417],[\"Q\",959.8847598385705,809.1202732420759,958.8844565749878,786.1132990067889],[\"Q\",957.8841533114052,763.1063247715019,951.8823337299089,742.0999569914574],[\"Q\",945.8805141484125,721.0935892114128,937.8780880397509,704.0884343418529],[\"Q\",929.8756619310892,687.0832794722929,921.8732358224275,673.0790342855964],[\"Q\",913.8708097137659,659.0747890989,905.8683836051042,645.0705439122037],[\"Q\",897.8659574964425,631.0662987255072,890.8638346513635,622.0635696769166],[\"Q\",883.8617118062846,613.0608406283261,878.8601954883711,607.0590212625991],[\"Q\",873.8586791704575,601.057201896872,868.857162852544,595.0553825311449],[\"Q\",863.8556465346304,589.0535631654179,858.8541302167168,584.052047027312],[\"Q\",853.8526138988034,579.0505308892062,848.8510975808898,576.0496212063427],[\"Q\",843.8495812629762,573.0487115234793,838.8480649450627,571.048105068237],[\"Q\",833.8465486271491,569.0474986129946,828.8450323092356,568.0471953853734],[\"Q\",823.8435159913221,567.0468921577522,816.841393146243,567.0468921577522],[\"Q\",809.8392703011641,567.0468921577522,799.836237665337,567.0468921577522],[\"Q\",789.8332050295099,567.0468921577522,775.828959339352,567.0468921577522],[\"Q\",761.8247136491941,567.0468921577522,747.8204679590361,567.0468921577522],[\"Q\",733.8162222688782,567.0468921577522,720.812279842303,567.0468921577522],[\"Q\",707.8083374157278,567.0468921577522,695.8046982527353,567.0468921577522],[\"Q\",683.8010590897427,567.0468921577522,675.798632981081,567.0468921577522],[\"Q\",667.7962068724194,567.0468921577522,662.7946905545059,566.0465889301311],[\"L\",657.7901742365923,565.0432857025098]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":506.24,\"top\":811.62,\"width\":108.04,\"height\":0,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",507.7446846991859,813.1214861525606],[\"Q\",507.74768469918587,813.1214861525606,510.748594489934,813.1214861525606],[\"Q\",513.7495042806821,813.1214861525606,521.7519303893438,813.1214861525606],[\"Q\",529.7543564980054,813.1214861525606,542.7582989245807,813.1214861525606],[\"Q\",555.7622413511559,813.1214861525606,568.7661837777312,813.1214861525606],[\"Q\",581.7701262043064,813.1214861525606,590.7728555765508,813.1214861525606],[\"Q\",599.7755849487952,813.1214861525606,607.7780110574569,813.1214861525606],[\"L\",615.7834371661186,813.1214861525606]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":664.29,\"top\":811.62,\"width\":140.05,\"height\":0,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",665.792600345254,813.1214861525606],[\"Q\",665.795600345254,813.1214861525606,669.7968133995848,813.1214861525606],[\"Q\",673.7980264539157,813.1214861525606,683.8010590897427,813.1214861525606],[\"Q\",693.8040917255698,813.1214861525606,707.8083374157277,813.1214861525606],[\"Q\",721.8125831058857,813.1214861525606,735.8168287960436,813.1214861525606],[\"Q\",749.8210744862016,813.1214861525606,761.8247136491941,813.1214861525606],[\"Q\",773.8283528121866,813.1214861525606,783.8313854480136,813.1214861525606],[\"Q\",793.8344180838408,813.1214861525606,799.836237665337,813.1214861525606],[\"L\",805.8410572468333,813.1214861525606]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":546.26,\"top\":955.66,\"width\":204.06,\"height\":160.05,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",551.7640282968251,957.1621509300094],[\"Q\",551.7610282968251,957.1651509300094,550.7607250332424,957.1651509300094],[\"Q\",549.7604217696597,957.1651509300094,548.760118506077,958.1654541576306],[\"Q\",547.7598152424943,959.1657573852518,547.7598152424943,960.166060612873],[\"Q\",547.7598152424943,961.1663638404941,547.7598152424943,965.1675767509788],[\"Q\",547.7598152424943,969.1687896614635,547.7598152424943,976.1709122548117],[\"Q\",547.7598152424943,983.1730348481599,547.7598152424943,992.1757638967505],[\"Q\",547.7598152424943,1001.1784929453411,548.760118506077,1012.181828449174],[\"Q\",549.7604217696597,1023.1851639530068,551.7610282968251,1034.1884994568397],[\"Q\",553.7616348239906,1045.1918349606726,558.763151141904,1055.1948672368844],[\"Q\",563.7646674598176,1065.197899513096,571.7670935684793,1074.2006285616867],[\"Q\",579.7695196771409,1083.2033576102772,588.7722490493853,1090.2054802036255],[\"Q\",597.7749784216297,1097.2076027969736,605.7774045302914,1102.2091189350795],[\"Q\",613.7798306389531,1107.2106350731854,624.7831665383628,1110.2115447560489],[\"Q\",635.7865024377727,1113.2124544389123,647.7901416007652,1115.2130608941548],[\"Q\",659.7937807637577,1117.2136673493972,667.7962068724194,1117.2136673493972],[\"Q\",675.798632981081,1117.2136673493972,683.8010590897427,1117.2136673493972],[\"Q\",691.8034851984044,1117.2136673493972,699.805911307066,1113.2124544389126],[\"Q\",707.8083374157278,1109.2112415284278,713.8101569972241,1100.2085124798373],[\"Q\",719.8119765787203,1091.2057834312466,725.8137961602165,1077.2015382445502],[\"Q\",731.8156157417128,1063.1972930578538,735.8168287960436,1049.1930478711574],[\"Q\",739.8180418503745,1035.1888026844608,742.8189516411226,1024.185467180628],[\"Q\",745.8198614318708,1013.1821316767952,746.8201646954535,1005.1797058558258],[\"Q\",747.8204679590361,997.1772800348564,749.8210744862015,993.1760671243717],[\"Q\",751.821681013367,989.174854213887,751.821681013367,988.1745509862658],[\"L\",751.821681013367,987.1742477586446]]}]}";
      var canvasImage = "canvas.png";
      var fallbackImage = null;
      var fabricCanvas = null, saveTimer = null;
      
      // Store the original canvas dimensions from the JSON
      var originalWidth = 600;
      var originalHeight = 800;
      var originalW = 600, originalH = 800; // defaults
      var editor = document.getElementById('editor');
      var saveStatus = document.getElementById('saveStatus');
      
      try { var saved = localStorage.getItem(STORAGE_KEY); if (saved) { var data = JSON.parse(saved); if (data.content) editor.value = data.content; } } catch(e){}
      
      function scheduleSave() {
        if (saveTimer) clearTimeout(saveTimer);
        saveTimer = setTimeout(function() {
          try { localStorage.setItem(STORAGE_KEY, JSON.stringify({ content: editor.value })); saveStatus.textContent = 'saved'; } catch(e){}
        }, 1000);
      }
      editor.addEventListener('input', function() { saveStatus.textContent = 'modified'; scheduleSave(); });
      
      function scaleCanvasToFit() {
        var container = document.getElementById('canvasContainer');
        var wrapper = document.getElementById('canvasWrapper');
        var rect = container.getBoundingClientRect();
        var containerW = rect.width - 20;
        var containerH = rect.height - 20;
        
        if (containerW <= 0 || containerH <= 0) return;
        
        var scaleX = containerW / originalWidth;
        var scaleY = containerH / originalHeight;
        var scale = Math.min(scaleX, scaleY, 1); // never scale up beyond 1
        
        wrapper.style.transform = 'scale(' + scale + ')';
      }
      
      function initCanvas() {
        // Get original dimensions from JSON if available
        if (canvasJson) {
          originalWidth = canvasJson.width || 600;
          originalHeight = canvasJson.height || 800;
        }
        
        var el = document.getElementById('fabricCanvas');
        el.width = originalWidth;
        el.height = originalHeight;
        
        fabricCanvas = new fabric.Canvas('fabricCanvas', { 
          width: originalWidth, 
          height: originalHeight, 
          backgroundColor: null 
        });
        fabricCanvas.freeDrawingBrush.width = 3;
        fabricCanvas.freeDrawingBrush.color = '#000000';
        
        if (canvasJson) {
          fabricCanvas.loadFromJSON(canvasJson, function() {
            fabricCanvas.renderAll();
            scaleCanvasToFit();
          });
        } else if (canvasImage || fallbackImage) {
          fabric.Image.fromURL(canvasImage || fallbackImage, function(img) {
            if (!img) return;
            img.set({ left: 0, top: 0, selectable: true });
            fabricCanvas.add(img);
            fabricCanvas.renderAll();
            scaleCanvasToFit();
          }, null, { crossOrigin: 'anonymous' });
        } else {
          scaleCanvasToFit();
        }
      }
      
      document.getElementById('selectBtn').onclick = function() { 
        if(fabricCanvas) { 
          fabricCanvas.isDrawingMode = false; 
          this.classList.add('active'); 
          document.getElementById('drawBtn').classList.remove('active'); 
        } 
      };
      document.getElementById('drawBtn').onclick = function() { 
        if(fabricCanvas) { 
          fabricCanvas.isDrawingMode = true; 
          this.classList.add('active'); 
          document.getElementById('selectBtn').classList.remove('active'); 
        } 
      };
      
      setTimeout(initCanvas, 150);
      
      window.addEventListener('resize', function() {
        scaleCanvasToFit();
      });
    })();
  </script>
</body>
</html>