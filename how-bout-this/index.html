<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>How bout this - Noat Boat</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f2f2f2; color: #111; height: 100vh; display: flex; flex-direction: column; }
    .topbar { display: flex; align-items: center; padding: 10px 14px; border-bottom: 1px solid #d9d9d9; background: #ffffff; gap: 12px; }
    .back-btn { padding: 6px 12px; border: 1px solid #d9d9d9; background: #ffffff; border-radius: 6px; cursor: pointer; font-size: 13px; color: #111; text-decoration: none; }
    .title { font-size: 16px; font-weight: 700; font-family: monospace; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .save-status { font-size: 12px; color: #666; font-family: monospace; }
    .main { display: flex; flex: 1; overflow: hidden; gap: 16px; padding: 14px; min-height: 0; }
    .editor-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; min-height: 0; }
    textarea { flex: 1; border: 1px solid #d9d9d9; border-radius: 12px; resize: none; padding: 14px; font-size: 14px; line-height: 1.55; font-family: monospace; background: #fff; color: #111; outline: none; }
    .canvas-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; min-height: 0; border: 1px solid #d9d9d9; border-radius: 12px; overflow: hidden; background: #fff; }
    .canvas-toolbar { display: flex; gap: 6px; padding: 8px 10px; border-bottom: 1px solid #d9d9d9; background: #ffffff; flex-shrink: 0; }
    .btn { padding: 5px 10px; border: 1px solid #d9d9d9; background: #ffffff; border-radius: 6px; cursor: pointer; font-size: 12px; color: #111; }
    .btn.active { background: #eef5ff; border-color: #c9dcff; }
    #canvasContainer { flex: 1; position: relative; overflow: hidden; min-height: 0; }
    #canvasContainer canvas { display: block; }
    #canvasContainer .canvas-container { position: absolute !important; }
    .audio-player { padding: 10px; border-top: 1px solid #d9d9d9; display: none; flex-shrink: 0; }
    .audio-player audio { width: 100%; }
    @media (max-width: 768px) { .main { flex-direction: column; } .editor-pane, .canvas-pane { flex: none; height: 45vh; } }
  </style>
</head>
<body>
  <div class="topbar">
    <a href="../index.html" class="back-btn">Back</a>
    <div class="title">How bout this</div>
    <div class="save-status" id="saveStatus"></div>
  </div>
  <div class="main">
    <div class="editor-pane">
      <textarea id="editor" spellcheck="false">Ok how about this man does this work?</textarea>
    </div>
    <div class="canvas-pane" id="canvasPane">
      <div class="canvas-toolbar">
        <button id="selectBtn" class="btn active">Select</button>
        <button id="drawBtn" class="btn">Draw</button>
      </div>
      <div id="canvasContainer">
        <canvas id="fabricCanvas"></canvas>
      </div>
      <div class="audio-player"><audio controls loop src=""></audio></div>
    </div>
  </div>
  <script>
    (function() {
      var STORAGE_KEY = 'noatboat_' + "how-bout-this";
      var canvasJson = "{\"version\":\"5.3.0\",\"objects\":[{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":418.22,\"top\":521.53,\"width\":392.12,\"height\":552.17,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",711.8125504700587,541.0390082396017],[\"Q\",711.8095504700586,541.0390082396017,710.8092472064759,541.0390082396017],[\"Q\",709.8089439428932,541.0390082396017,701.8065178342315,541.0390082396017],[\"Q\",693.8040917255698,541.0390082396017,679.799846035412,541.0390082396017],[\"Q\",665.795600345254,541.0390082396017,643.7889285464344,545.0402211500864],[\"Q\",621.7822567476147,549.0414340605711,597.7749784216297,556.0435566539193],[\"Q\",573.7677000956447,563.0456792472675,552.7613315604078,573.0487115234791],[\"Q\",531.7549630251709,583.0517437996909,512.7492010170995,594.0550793035238],[\"Q\",493.74343900902795,605.0584148073567,479.73919331887004,619.0626599940531],[\"Q\",465.7349476287121,633.0669051807496,455.731914992885,649.0717568226883],[\"Q\",445.7288823570579,665.076608464627,437.72645624839623,696.0860085208834],[\"Q\",429.72403013973457,727.0954085771398,424.72251382182105,770.1084473648502],[\"Q\",419.7209975039075,813.1214861525606,419.7209975039075,851.1330088021651],[\"Q\",419.7209975039075,889.1445314517697,422.7219072946556,925.155447646132],[\"Q\",425.72281708540373,961.1663638404941,432.7249399304827,988.1745509862658],[\"Q\",439.72706277556165,1015.1827381320375,444.7285790934752,1025.185770408249],[\"Q\",449.73009541138873,1035.1888026844608,452.7310052021369,1038.1897123673243],[\"Q\",455.731914992885,1041.190622050188,465.7349476287121,1042.1909252778091],[\"Q\",475.7379802645392,1043.1912285054302,485.7410129003663,1046.192138188294],[\"Q\",495.74404553619337,1049.1930478711574,505.74707817202045,1053.194260781642],[\"Q\",515.7501108078476,1057.1954736921266,529.7543564980056,1061.1966866026114],[\"Q\",543.7586021881634,1065.197899513096,561.7640609326522,1068.1988091959597],[\"Q\",579.7695196771409,1071.1997188788232,593.7737653672989,1073.2003253340654],[\"Q\",607.7780110574569,1075.2009317893078,625.7834698019456,1075.2009317893078],[\"Q\",643.7889285464344,1075.2009317893078,661.7943872909232,1075.2009317893078],[\"Q\",679.7998460354119,1075.2009317893078,694.8043949891526,1075.2009317893078],[\"Q\",709.8089439428932,1075.2009317893078,721.8125831058857,1073.2003253340654],[\"Q\",733.8162222688782,1071.1997188788232,742.8189516411226,1067.1985059683384],[\"Q\",751.821681013367,1063.1972930578538,756.8231973312805,1060.19638337499],[\"Q\",761.8247136491941,1057.1954736921266,766.8262299671076,1052.193957554021],[\"Q\",771.8277462850211,1047.192441415915,775.828959339352,1038.1897123673243],[\"Q\",779.8301723936828,1029.1869833187338,784.8316887115964,1016.1830413596585],[\"Q\",789.8332050295099,1003.1790994005834,793.8344180838408,984.1733380757811],[\"Q\",797.8356311381716,965.1675767509788,801.8368441925024,944.1612089709342],[\"Q\",805.8380572468333,923.1548411908896,807.8386637739986,903.1487766384662],[\"Q\",809.8392703011641,883.1427120860427,810.8395735647468,867.1378604441039],[\"Q\",811.8398768283296,851.1330088021651,811.8398768283296,835.1281571602265],[\"Q\",811.8398768283296,819.1233055182877,811.8398768283296,801.1178474211065],[\"Q\",811.8398768283296,783.1123893239254,810.8395735647468,770.1084473648502],[\"Q\",809.8392703011641,757.104505405775,807.8386637739986,746.1011699019421],[\"Q\",805.8380572468333,735.0978343981092,803.8374507196679,726.0951053495187],[\"Q\",801.8368441925024,717.0923763009281,799.836237665337,711.090556935201],[\"Q\",797.8356311381716,705.088737569474,795.8350246110062,699.086918203747],[\"Q\",793.8344180838408,693.0850988380199,790.8335082930926,685.0826730170505],[\"Q\",787.8325985023445,677.0802471960811,782.8310821844309,668.0775181474905],[\"Q\",777.8295658665174,659.0747890989,772.8280495486039,647.071150367446],[\"Q\",767.8265332306903,635.0675116359919,762.8250169127768,624.064176132159],[\"Q\",757.8235005948633,613.0608406283261,751.821681013367,603.0578083521143],[\"Q\",745.8198614318708,593.0547760759026,741.8186483775398,584.052047027312],[\"Q\",737.817435323209,575.0493179787215,733.8162222688782,570.0478018406156],[\"Q\",729.8150092145473,565.0462857025099,727.814402687382,562.0453760196463],[\"Q\",725.8137961602165,559.0444663367828,722.8128863694684,558.0441631091617],[\"Q\",719.8119765787203,557.0438598815405,715.8107635243895,555.0432534262982],[\"Q\",711.8095504700586,553.0426469710558,706.8080341521451,550.0417372881923],[\"Q\",701.8065178342315,547.0408276053287,695.8046982527353,544.0399179224652],[\"Q\",689.802878671239,541.0390082396017,683.8010590897427,538.0380985567382],[\"Q\",677.7992395082465,535.0371888738747,672.7977231903329,532.0362791910111],[\"Q\",667.7962068724194,529.0353695081476,661.7943872909232,526.0344598252841],[\"L\",655.7895677094268,523.0305501424206]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":526.25,\"top\":771.61,\"width\":14.01,\"height\":10.01,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",527.75074997084,773.1063570477137],[\"Q\",527.7537499708401,773.1093570477137,527.7537499708401,774.1096602753348],[\"Q\",527.7537499708401,775.109963502956,529.7543564980056,776.1102667305772],[\"Q\",531.7549630251709,777.1105699581984,533.7555695523363,779.1111764134407],[\"Q\",535.7561760795018,781.1117828686831,537.7567826066672,782.1120860963042],[\"Q\",539.7573891338326,783.1123893239254,540.7576923974153,783.1123893239254],[\"L\",541.7609956609981,783.1123893239254]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":632.28,\"top\":773.61,\"width\":2.01,\"height\":0,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",633.7828959106072,775.109963502956],[\"Q\",633.7858959106072,775.109963502956,634.78619917419,775.109963502956],[\"L\",635.7895024377727,775.109963502956]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":520.25,\"top\":881.64,\"width\":164.06,\"height\":52.02,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",521.7489303893437,917.1500218251625],[\"Q\",521.7519303893438,917.1530218251626,523.7525369165091,919.153628280405],[\"Q\",525.7531434436746,921.1542347356473,529.7543564980054,923.1548411908896],[\"Q\",533.7555695523363,925.155447646132,540.7576923974152,928.1563573289955],[\"Q\",547.7598152424943,931.157267011859,558.763151141904,933.1578734671014],[\"Q\",569.7664870413139,935.1584799223436,581.7701262043064,935.1584799223436],[\"Q\",593.7737653672989,935.1584799223436,603.776798003126,935.1584799223436],[\"Q\",613.7798306389531,935.1584799223436,622.7825600111975,935.1584799223436],[\"Q\",631.7852893834419,935.1584799223436,636.7868057013554,935.1584799223436],[\"Q\",641.7883220192689,935.1584799223436,645.7895350735998,933.1578734671014],[\"Q\",649.7907481279307,931.157267011859,652.7916579186788,927.1560541013743],[\"Q\",655.7925677094269,923.1548411908896,659.7937807637577,918.1533250527837],[\"Q\",663.7949938180885,913.1518089146779,667.7962068724194,907.1499895489508],[\"Q\",671.7974199267502,901.1481701832238,674.7983297174983,896.1466540451179],[\"Q\",677.7992395082465,891.1451379070121,680.8001492989946,888.1442282241485],[\"Q\",683.8010590897427,885.143318541285,684.8013623533254,884.1430153136639],[\"L\",685.8046656169082,883.1397120860427]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":118.13,\"top\":1665.88,\"width\":92.03,\"height\":86.03,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",119.62701842909465,1667.377442541042],[\"Q\",119.63001842909465,1667.380442541042,120.63032169267736,1668.380745768663],[\"Q\",121.63062495626006,1669.3810489962843,126.63214127417362,1675.3828683620113],[\"Q\",131.63365759208716,1681.3846877277383,141.63669022791424,1692.3880232315712],[\"Q\",151.63972286374135,1703.391358735404,162.64305876315115,1712.3940877839946],[\"Q\",173.64639466256097,1721.3968168325853,181.64882077122263,1729.3992426535547],[\"Q\",189.6512468798843,1737.401668474524,196.65336972496328,1742.40318461263],[\"Q\",203.65549257004224,1747.4047007507359,207.65670562437307,1750.4056104335993],[\"L\",211.6609186787039,1753.4095201164628]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":118.13,\"top\":1677.88,\"width\":86.03,\"height\":78.03,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",205.65909909720764,1679.381081272496],[\"Q\",205.65609909720766,1679.384081272496,204.65579583362495,1679.384081272496],[\"Q\",203.65549257004224,1679.384081272496,202.65518930645953,1681.3846877277383],[\"Q\",201.65488604287683,1683.3852941829807,198.6539762521287,1686.3862038658442],[\"Q\",195.65306646138058,1689.3871135487077,191.6518534070497,1693.3883264591923],[\"Q\",187.65064035271888,1697.389539369677,182.64912403480534,1702.391055507783],[\"Q\",177.6476077168918,1707.392571645889,173.64639466256097,1710.3934813287524],[\"Q\",169.64518160823013,1713.3943910116159,166.64427181748198,1715.394997466858],[\"Q\",163.64336202673385,1717.3956039221005,160.64245223598573,1719.3962103773429],[\"Q\",157.6415424452376,1721.3968168325853,155.6409359180722,1722.3971200602064],[\"Q\",153.64032939090677,1723.3974232878277,152.64002612732406,1723.3974232878277],[\"Q\",151.63972286374135,1723.3974232878277,150.63941960015865,1724.3977265154488],[\"Q\",149.63911633657594,1725.3980297430699,148.63881307299323,1727.3986361983123],[\"Q\",147.63850980941052,1729.3992426535547,143.63729675507966,1733.4004555640395],[\"Q\",139.63608370074883,1737.401668474524,135.634870646418,1741.4028813850086],[\"Q\",131.63365759208716,1745.4040942954935,127.63244453775633,1748.405003978357],[\"Q\",123.63123148342548,1751.4059136612204,121.63062495626006,1754.406823344084],[\"L\",119.62701842909465,1757.4107330269474]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":1106.43,\"top\":1615.87,\"width\":136.04,\"height\":128.04,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",1107.9266428488115,1617.3652811599834],[\"Q\",1107.9296428488115,1617.3652811599834,1108.9299461123942,1617.3652811599834],[\"Q\",1109.930249375977,1617.3652811599834,1110.9305526395597,1617.3652811599834],[\"Q\",1111.9308559031424,1617.3652811599834,1116.932372221056,1622.3667972980893],[\"Q\",1121.9338885389695,1627.368313436195,1132.9372244383794,1637.3713457124068],[\"Q\",1143.940560337789,1647.3743779886186,1159.9454125551124,1662.378926402936],[\"Q\",1175.9502647724357,1677.3834748172537,1189.9545104625936,1692.3880232315714],[\"Q\",1203.9587561527517,1707.392571645889,1214.9620920521616,1717.3956039221007],[\"Q\",1225.9654279515712,1727.3986361983123,1231.9672475330676,1733.4004555640395],[\"Q\",1237.9690671145638,1739.4022749297665,1240.9699769053118,1742.40318461263],[\"L\",1243.97088669606,1745.4040942954935]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":1112.43,\"top\":1601.86,\"width\":116.04,\"height\":138.05,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",1229.969641005902,1603.3580359732869],[\"Q\",1229.9666410059021,1603.3610359732868,1227.9660344787367,1605.3616424285292],[\"Q\",1225.9654279515712,1607.3622488837716,1220.9639116336575,1613.3640682494986],[\"Q\",1215.962395315744,1619.3658876152256,1208.9602724706651,1629.3689198914374],[\"Q\",1201.9581496255862,1639.3719521676492,1193.9557235169245,1652.3758941267242],[\"Q\",1185.9532974082629,1665.3798360857995,1178.951174563184,1675.3828683620113],[\"Q\",1171.949051718105,1685.3859006382231,1165.9472321366088,1692.3880232315714],[\"Q\",1159.9454125551124,1699.3901458249195,1155.9441995007815,1704.3916619630254],[\"Q\",1151.9429864464507,1709.3931781011313,1149.9423799192853,1711.3937845563737],[\"Q\",1147.9417733921198,1713.3943910116159,1146.9414701285373,1713.3943910116159],[\"Q\",1145.9411668649545,1713.3943910116159,1144.9408636013718,1714.3946942392372],[\"Q\",1143.940560337789,1715.3949974668583,1141.9399538106236,1716.3953006944794],[\"Q\",1139.9393472834581,1717.3956039221005,1136.93843749271,1719.3962103773429],[\"Q\",1133.937527701962,1721.3968168325853,1130.936617911214,1725.3980297430699],[\"Q\",1127.9357081204657,1729.3992426535547,1124.9347983297175,1732.4001523364182],[\"Q\",1121.9338885389695,1735.4010620192817,1117.9326754846388,1738.4019717021451],[\"L\",1113.928462430308,1741.4058813850086]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":1142.44,\"top\":45.64,\"width\":150.05,\"height\":105.78,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",1143.9375603377891,48.88682024998481],[\"Q\",1143.940560337789,48.88982024998481,1143.940560337789,47.889517022363634],[\"Q\",1143.940560337789,46.88921379474246,1144.9408636013718,47.889517022363634],[\"Q\",1145.9411668649545,48.88982024998481,1148.9420766557027,51.89072993284832],[\"Q\",1151.9429864464507,54.89163961571184,1158.9451092915297,60.893458981438876],[\"Q\",1165.9472321366086,66.89527834716591,1176.9505680360185,74.89770416813529],[\"Q\",1187.9539039354283,82.90012998910467,1202.958452889169,92.9031622653164],[\"Q\",1217.9630018429095,102.90619454152812,1230.9669442694849,111.90892359011868],[\"Q\",1243.97088669606,120.91165263870923,1253.9739193318871,127.91377523205743],[\"Q\",1263.9769519677143,134.91589782540564,1272.9796813399585,140.91771719113268],[\"Q\",1281.9824107122029,146.91953655685973,1285.9836237665336,148.92014301210207],[\"Q\",1289.9848368208645,150.9207494673444,1291.98544334803,151.92105269496557],[\"L\",1293.9860498751955,152.92135592258674]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":1164.44,\"top\":45.39,\"width\":102.04,\"height\":116.04,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",1267.981165022045,46.88621379474246],[\"Q\",1267.978165022045,46.88921379474246,1266.9778617584623,46.88921379474246],[\"Q\",1265.9775584948795,46.88921379474246,1263.9769519677143,49.89012347760598],[\"Q\",1261.9763454405488,52.8910331604695,1257.9751323862179,57.89254929857536],[\"Q\",1253.9739193318871,62.894065436681224,1247.972099750391,71.89679448527177],[\"Q\",1241.9702801688945,80.89952353386232,1234.9681573238156,89.90225258245287],[\"Q\",1227.9660344787367,98.90498163104343,1221.9642148972403,105.90710422439165],[\"Q\",1215.962395315744,112.90922681773985,1210.9608789978306,119.91134941108805],[\"Q\",1205.959362679917,126.91347200443626,1201.958149625586,131.91498814254211],[\"Q\",1197.9569365712553,136.91650428064798,1194.9560267805073,139.9174139635115],[\"Q\",1191.955116989759,142.91832364637503,1190.9548137261763,144.91893010161738],[\"Q\",1189.9545104625936,146.91953655685973,1188.9542071990109,146.91953655685973],[\"Q\",1187.9539039354283,146.91953655685973,1186.9536006718456,146.91953655685973],[\"Q\",1185.9532974082629,146.91953655685973,1181.9520843539322,150.92074946734442],[\"Q\",1177.9508712996012,154.9219623778291,1174.949961508853,156.92256883307144],[\"Q\",1171.949051718105,158.9231752883138,1168.9481419273568,160.92378174355613],[\"L\",1165.9442321366087,162.92738819879847]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":50.11,\"top\":51.39,\"width\":122.04,\"height\":112.04,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",51.606396505470414,52.8880331604695],[\"Q\",51.609396505470414,52.8910331604695,52.60969976905312,52.8910331604695],[\"Q\",53.61000303263583,52.8910331604695,54.61030629621854,53.891336388090664],[\"Q\",55.61060955980125,54.89163961571184,59.61182261413209,57.89254929857536],[\"Q\",63.61303566846293,60.893458981438876,68.61455198637648,65.89497511954474],[\"Q\",73.61606830429002,70.8964912576506,79.61788788578627,77.8986138509988],[\"Q\",85.61970746728252,84.90073644434702,94.62243683952691,93.90346549293757],[\"Q\",103.6251662117713,102.90619454152812,112.62789558401568,112.90922681773985],[\"Q\",121.63062495626006,122.91225909395158,128.63274780133904,129.9143816872998],[\"Q\",135.634870646418,136.91650428064798,140.63638696433156,140.91771719113268],[\"Q\",145.6379032822451,144.91893010161738,150.63941960015865,148.92014301210207],[\"Q\",155.6409359180722,152.92135592258674,158.6418457088203,154.9219623778291],[\"Q\",161.64275549956844,156.92256883307144,162.64305876315115,157.9228720606926],[\"Q\",163.64336202673385,158.9231752883138,164.64366529031656,158.9231752883138],[\"Q\",165.64396855389927,158.9231752883138,165.64396855389927,159.92347851593496],[\"Q\",165.64396855389927,160.92378174355613,166.64427181748198,160.92378174355613],[\"Q\",167.6445750810647,160.92378174355613,169.64518160823013,161.9240849711773],[\"Q\",171.64578813539555,162.92438819879848,172.64609139897826,163.92469142641966],[\"L\",173.64939466256095,164.92799465404082]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":66.11,\"top\":65.39,\"width\":80.03,\"height\":90.03,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",147.6415098094105,66.89227834716591],[\"Q\",147.63850980941052,66.89527834716591,146.6382065458278,68.89588480240826],[\"Q\",145.6379032822451,70.8964912576506,143.63729675507966,74.89770416813529],[\"Q\",141.63669022791424,78.89891707861999,138.63578043716612,83.90043321672584],[\"Q\",135.634870646418,88.90194935483171,133.63426411925258,92.90316226531641],[\"Q\",131.63365759208716,96.90437517580109,128.63274780133904,100.90558808628577],[\"Q\",125.63183801059091,104.90680099677047,123.6312314834255,108.90801390725517],[\"Q\",121.63062495626006,112.90922681773985,119.63001842909465,114.90983327298218],[\"Q\",117.62941190192923,116.91043972822453,116.62910863834652,117.9107429558457],[\"Q\",115.62880537476381,118.91104618346688,115.62880537476381,119.91134941108805],[\"Q\",115.62880537476381,120.91165263870923,114.6285021111811,121.9119558663304],[\"Q\",113.6281988475984,122.91225909395158,112.62789558401569,124.91286554919392],[\"Q\",111.62759232043298,126.91347200443626,110.62728905685026,127.91377523205745],[\"Q\",109.62698579326755,128.91407845967862,107.62637926610213,129.9143816872998],[\"Q\",105.62577273893672,130.91468491492094,103.6251662117713,132.9152913701633],[\"Q\",101.62455968460588,134.91589782540564,99.62395315744047,136.91650428064798],[\"Q\",97.62334663027504,138.91711073589033,96.62304336669233,139.9174139635115],[\"Q\",95.62274010310962,140.91771719113268,94.62243683952691,140.91771719113268],[\"Q\",93.6221335759442,140.91771719113268,92.6218303123615,141.91802041875385],[\"Q\",91.62152704877879,142.91832364637503,90.62122378519608,143.9186268739962],[\"Q\",89.62092052161337,144.91893010161738,87.62031399444794,145.91923332923855],[\"Q\",85.61970746728252,146.91953655685973,83.61910094011711,148.92014301210207],[\"Q\",81.61849441295169,150.9207494673444,77.61728135862086,152.92135592258674],[\"Q\",73.61606830429002,154.9219623778291,72.61576504070732,155.92226560545026],[\"Q\",71.6154617771246,156.92256883307144,69.61485524995918,156.92256883307144],[\"L\",67.61124872279376,156.92256883307144]]}]}";
      var canvasImage = "canvas.png";
      var fallbackImage = null;
      var fabricCanvas = null, saveTimer = null;
      var CANVAS_WIDTH = 1200;
      var CANVAS_HEIGHT = 1600;
      
      var editor = document.getElementById('editor');
      var saveStatus = document.getElementById('saveStatus');
      
      try { var saved = localStorage.getItem(STORAGE_KEY); if (saved) { var data = JSON.parse(saved); if (data.content) editor.value = data.content; } } catch(e){}
      
      function scheduleSave() {
        if (saveTimer) clearTimeout(saveTimer);
        saveTimer = setTimeout(function() {
          try { localStorage.setItem(STORAGE_KEY, JSON.stringify({ content: editor.value })); saveStatus.textContent = 'saved'; } catch(e){}
        }, 1000);
      }
      editor.addEventListener('input', function() { saveStatus.textContent = 'modified'; scheduleSave(); });
      
      function resizeFabricCanvas() {
        if (!fabricCanvas) return;
        var container = document.getElementById('canvasContainer');
        var rect = container.getBoundingClientRect();
        if (rect.width <= 0 || rect.height <= 0) return;
        
        // Scale canvas to fit container exactly
        var scaleX = rect.width / CANVAS_WIDTH;
        var scaleY = rect.height / CANVAS_HEIGHT;
        var scale = Math.min(scaleX, scaleY);
        
        // Apply CSS transform to scale the canvas
        var canvasWrapper = fabricCanvas.wrapperEl;
        if (canvasWrapper) {
          canvasWrapper.style.transformOrigin = 'top left';
          canvasWrapper.style.transform = 'scale(' + scale + ')';
          
          // Center the canvas if there's extra space
          var scaledWidth = CANVAS_WIDTH * scale;
          var scaledHeight = CANVAS_HEIGHT * scale;
          var offsetX = (rect.width - scaledWidth) / 2;
          var offsetY = (rect.height - scaledHeight) / 2;
          canvasWrapper.style.marginLeft = offsetX + 'px';
          canvasWrapper.style.marginTop = offsetY + 'px';
        }
      }
      
      function initCanvas() {
        var container = document.getElementById('canvasContainer');
        var rect = container.getBoundingClientRect();
        
        // Get original aspect ratio from canvas JSON
        var originalWidth = 1200;
        var originalHeight = 1600;
        if (canvasJson && canvasJson.width && canvasJson.height) {
          originalWidth = canvasJson.width;
          originalHeight = canvasJson.height;
        }
        var aspectRatio = originalWidth / originalHeight;
        
        // Calculate canvas size maintaining original aspect ratio
        if (rect.width > 0 && rect.height > 0) {
          var scale = 2; // 2x for crisp rendering
          var containerAspect = rect.width / rect.height;
          
          if (containerAspect > aspectRatio) {
            // Container is wider - fit to height
            CANVAS_HEIGHT = Math.round(rect.height * scale);
            CANVAS_WIDTH = Math.round(CANVAS_HEIGHT * aspectRatio);
          } else {
            // Container is taller - fit to width
            CANVAS_WIDTH = Math.round(rect.width * scale);
            CANVAS_HEIGHT = Math.round(CANVAS_WIDTH / aspectRatio);
          }
        }
        
        fabricCanvas = new fabric.Canvas('fabricCanvas', { 
          width: CANVAS_WIDTH, 
          height: CANVAS_HEIGHT, 
          backgroundColor: null,
          selection: true,
          preserveObjectStacking: true
        });
        fabricCanvas.freeDrawingBrush.width = 3;
        fabricCanvas.freeDrawingBrush.color = '#000000';
        
        if (canvasJson) {
          fabricCanvas.loadFromJSON(canvasJson, function() {
            fabricCanvas.renderAll();
            resizeFabricCanvas();
          });
        } else if (canvasImage || fallbackImage) {
          fabric.Image.fromURL(canvasImage || fallbackImage, function(img) {
            if (!img) return;
            img.set({ left: 0, top: 0, selectable: true });
            fabricCanvas.add(img);
            fabricCanvas.renderAll();
            resizeFabricCanvas();
          }, null, { crossOrigin: 'anonymous' });
        } else {
          resizeFabricCanvas();
        }
      }
      
      document.getElementById('selectBtn').onclick = function() { 
        if(fabricCanvas) { 
          fabricCanvas.isDrawingMode = false; 
          this.classList.add('active'); 
          document.getElementById('drawBtn').classList.remove('active'); 
        } 
      };
      document.getElementById('drawBtn').onclick = function() { 
        if(fabricCanvas) { 
          fabricCanvas.isDrawingMode = true; 
          this.classList.add('active'); 
          document.getElementById('selectBtn').classList.remove('active'); 
        } 
      };
      
      setTimeout(initCanvas, 150);
      
      window.addEventListener('resize', function() {
        resizeFabricCanvas();
      });
    })();
  </script>
</body>
</html>