<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AGAIN BEEEE - Noat Boat</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f2f2f2; color: #111; height: 100vh; display: flex; flex-direction: column; }
    .topbar { display: flex; align-items: center; padding: 10px 14px; border-bottom: 1px solid #d9d9d9; background: #ffffff; gap: 12px; }
    .back-btn { padding: 6px 12px; border: 1px solid #d9d9d9; background: #ffffff; border-radius: 6px; cursor: pointer; font-size: 13px; color: #111; text-decoration: none; }
    .title { font-size: 16px; font-weight: 700; font-family: monospace; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .save-status { font-size: 12px; color: #666; font-family: monospace; }
    .main { display: flex; flex: 1; overflow: hidden; gap: 16px; padding: 14px; min-height: 0; }
    .editor-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; min-height: 0; }
    textarea { flex: 1; border: 1px solid #d9d9d9; border-radius: 12px; resize: none; padding: 14px; font-size: 14px; line-height: 1.55; font-family: monospace; background: #fff; color: #111; outline: none; }
    .canvas-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; min-height: 0; border: 1px solid #d9d9d9; border-radius: 12px; overflow: hidden; background: #fff; }
    .canvas-toolbar { display: flex; gap: 6px; padding: 8px 10px; border-bottom: 1px solid #d9d9d9; background: #ffffff; flex-shrink: 0; }
    .btn { padding: 5px 10px; border: 1px solid #d9d9d9; background: #ffffff; border-radius: 6px; cursor: pointer; font-size: 12px; color: #111; }
    .btn.active { background: #eef5ff; border-color: #c9dcff; }
    #canvasContainer { flex: 1; position: relative; overflow: hidden; min-height: 0; display: flex; align-items: center; justify-content: center; }
    .canvas-wrapper { transform-origin: center center; display: inline-block; }
    .audio-player { padding: 10px; border-top: 1px solid #d9d9d9; display: none; flex-shrink: 0; }
    .audio-player audio { width: 100%; }
    @media (max-width: 768px) { .main { flex-direction: column; } .editor-pane, .canvas-pane { flex: none; height: 45vh; } }
  </style>
</head>
<body>
  <div class="topbar">
    <a href="../index.html" class="back-btn">Back</a>
    <div class="title">AGAIN BEEEE</div>
    <div class="save-status" id="saveStatus"></div>
  </div>
  <div class="main">
    <div class="editor-pane">
      <textarea id="editor" spellcheck="false">this is again a note</textarea>
    </div>
    <div class="canvas-pane" id="canvasPane">
      <div class="canvas-toolbar">
        <button id="selectBtn" class="btn active">Select</button>
        <button id="drawBtn" class="btn">Draw</button>
      </div>
      <div id="canvasContainer">
        <div class="canvas-wrapper" id="canvasWrapper">
          <canvas id="fabricCanvas"></canvas>
        </div>
      </div>
      <div class="audio-player"><audio controls loop src=""></audio></div>
    </div>
  </div>
  <script>
    (function() {
      var STORAGE_KEY = 'noatboat_' + "again-beeee";
      var canvasJson = "{\"version\":\"5.3.0\",\"objects\":[{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":504.25,\"top\":611.56,\"width\":460.14,\"height\":536.16,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",713.813156997224,647.071150367446],[\"Q\",713.810156997224,647.071150367446,712.8098537336414,647.071150367446],[\"Q\",711.8095504700586,647.071150367446,706.8080341521451,647.071150367446],[\"Q\",701.8065178342315,647.071150367446,695.8046982527353,647.071150367446],[\"Q\",689.802878671239,647.071150367446,683.8010590897427,647.071150367446],[\"Q\",677.7992395082465,647.071150367446,671.7974199267503,649.0717568226883],[\"Q\",665.795600345254,651.0723632779307,654.7922644458442,656.0738794160366],[\"Q\",643.7889285464344,661.0753955541423,624.7831665383628,669.0778213751117],[\"Q\",605.7774045302914,677.0802471960811,587.7719457858027,686.0829762446717],[\"Q\",569.7664870413139,695.0857052932622,556.7625446147387,703.0881311142316],[\"Q\",543.7586021881634,711.090556935201,534.755872815919,719.0929827561704],[\"Q\",525.7531434436746,727.0954085771398,519.7513238621784,734.097531170488],[\"Q\",513.7495042806821,741.0996537638362,511.7488977535167,746.1011699019421],[\"Q\",509.7482912263513,751.102686040048,508.74798796276855,757.104505405775],[\"Q\",507.74768469918587,763.1063247715019,506.7473814356032,769.1081441372289],[\"Q\",505.74707817202045,775.109963502956,505.74707817202045,786.113299006789],[\"Q\",505.74707817202045,797.1166345106219,506.7473814356032,812.1211829249395],[\"Q\",507.74768469918587,827.1257313392571,509.7482912263513,847.1317958916804],[\"Q\",511.7488977535167,867.1378604441039,517.750717335013,889.1445314517697],[\"Q\",523.7525369165093,911.1512024594355,530.7546597615882,933.1578734671014],[\"Q\",537.7567826066671,955.1645444747671,544.7589054517462,974.1703057995694],[\"Q\",551.7610282968251,993.1760671243717,560.7637576690695,1010.1812219939316],[\"Q\",569.7664870413139,1027.1863768634914,579.769519677141,1042.1909252778091],[\"Q\",589.7725523129681,1057.1954736921266,600.7758882123778,1070.199415651202],[\"Q\",611.7792241117877,1083.2033576102772,621.7822567476148,1093.206389886489],[\"Q\",631.7852893834419,1103.2094221627005,639.7877154921035,1110.2115447560489],[\"Q\",647.7901416007652,1117.2136673493972,653.7919611822615,1123.2154867151241],[\"Q\",659.7937807637577,1129.2173060808511,665.7956003452539,1133.2185189913357],[\"Q\",671.7974199267502,1137.2197319018205,677.7992395082465,1140.220641584684],[\"Q\",683.8010590897427,1143.2215512675475,691.8034851984044,1144.2218544951688],[\"Q\",699.8059113070661,1145.22215772279,710.8092472064759,1146.222460950411],[\"Q\",721.8125831058857,1147.2227641780323,733.8162222688782,1148.2230674056534],[\"Q\",745.8198614318708,1149.2233706332745,759.8241071220286,1149.2233706332745],[\"Q\",773.8283528121866,1149.2233706332745,788.8329017659273,1148.2230674056534],[\"Q\",803.8374507196679,1147.2227641780323,816.841393146243,1144.2218544951688],[\"Q\",829.8453355728183,1141.220944812305,838.8480649450627,1138.2200351294416],[\"Q\",847.8507943173071,1135.2191254465781,854.8529171623861,1131.2179125360935],[\"Q\",861.855040007465,1127.2166996256087,865.8562530617959,1123.215486715124],[\"Q\",869.8574661161267,1119.2142738046393,870.8577693797095,1117.213667349397],[\"Q\",871.8580726432921,1115.2130608941548,872.8583759068748,1107.2106350731854],[\"Q\",873.8586791704575,1099.208209252216,876.8595889612056,1082.2030543826559],[\"Q\",879.8604987519537,1065.197899513096,885.86231833345,1049.1930478711574],[\"Q\",891.8641379149462,1033.1881962292186,898.8662607600252,1016.1830413596587],[\"Q\",905.8683836051042,999.1778864900987,912.8705064501833,982.1727316205388],[\"Q\",919.8726292952622,965.1675767509788,926.8747521403411,946.1618154261765],[\"Q\",933.87687498542,927.1560541013743,939.8786945669162,910.1508992318143],[\"Q\",945.8805141484125,893.1457443622544,948.8814239391606,878.1411959479368],[\"Q\",951.8823337299089,863.1366475336192,954.8832435206571,848.1320991193016],[\"Q\",957.8841533114052,833.1275507049841,959.8847598385705,819.1233055182877],[\"Q\",961.885366365736,805.1190603315912,963.8859728929015,792.115118372516],[\"Q\",965.8865794200668,779.1111764134407,965.8865794200668,767.1075376819867],[\"Q\",965.8865794200668,755.1038989505327,964.8862761564841,744.1005634466997],[\"Q\",963.8859728929013,733.0972279428668,962.8856696293187,723.0941956666551],[\"Q\",961.885366365736,713.0911633904434,959.8847598385705,705.088737569474],[\"Q\",957.8841533114052,697.0863117485046,953.8829402570743,691.0844923827776],[\"Q\",949.8817272027434,685.0826730170505,944.8802108848299,678.0805504237023],[\"Q\",939.8786945669164,671.0784278303541,932.8765717218373,664.076305237006],[\"Q\",925.8744488767584,657.0741826436577,919.8726292952622,651.0723632779307],[\"Q\",913.8708097137659,645.0705439122037,906.868686868687,640.0690277740978],[\"Q\",899.866564023608,635.0675116359919,892.864441178529,631.0662987255072],[\"Q\",885.86231833345,627.0650858150225,878.8601954883711,623.0638729045378],[\"Q\",871.8580726432921,619.0626599940531,862.8553432710478,617.0620535388107],[\"Q\",853.8526138988034,615.0614470835684,842.8492779993935,614.0611438559472],[\"Q\",831.8459420999837,613.0608406283261,816.841393146243,613.0608406283261],[\"Q\",801.8368441925024,613.0608406283261,785.8319919751791,615.0614470835685],[\"Q\",769.8271397578558,617.0620535388108,753.8222875405324,621.0632664492955],[\"Q\",737.817435323209,625.0644793597802,722.8128863694684,631.0662987255073],[\"Q\",707.8083374157278,637.0681180912343,695.8046982527353,642.0696342293402],[\"Q\",683.8010590897427,647.071150367446,674.7983297174983,650.0720600503095],[\"Q\",665.795600345254,653.072969733173,656.7928709730096,657.0741826436577],[\"Q\",647.7901416007652,661.0753955541423,642.7886252828516,663.0760020093846],[\"Q\",637.787108964938,665.076608464627,634.78619917419,666.0769116922482],[\"Q\",631.7852893834419,667.0772149198694,630.7849861198591,670.0781246027329],[\"L\",629.7816828562763,673.0820342855965]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":608.28,\"top\":769.61,\"width\":120.04,\"height\":6,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",609.7756175846222,777.1105699581984],[\"Q\",609.7786175846222,777.1105699581984,613.7798306389531,777.1105699581984],[\"Q\",617.7810436932839,777.1105699581984,627.784076329111,777.1105699581984],[\"Q\",637.787108964938,777.1105699581984,652.7916579186788,776.1102667305772],[\"Q\",667.7962068724194,775.109963502956,681.8004525625773,774.1096602753348],[\"Q\",695.8046982527353,773.1093570477137,704.8074276249797,772.1090538200925],[\"Q\",713.810156997224,771.1087505924713,721.8125831058857,771.1087505924713],[\"L\",729.8180092145474,771.1087505924713]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":776.33,\"top\":763.61,\"width\":56.02,\"height\":0,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",777.8265658665174,765.1069312267443],[\"Q\",777.8295658665174,765.1069312267443,778.8298691301002,765.1069312267443],[\"Q\",779.8301723936828,765.1069312267443,780.8304756572655,765.1069312267443],[\"Q\",781.8307789208483,765.1069312267443,782.8310821844309,765.1069312267443],[\"Q\",783.8313854480136,765.1069312267443,785.8319919751791,765.1069312267443],[\"Q\",787.8325985023445,765.1069312267443,789.8332050295098,765.1069312267443],[\"Q\",791.8338115566753,765.1069312267443,794.8347213474235,765.1069312267443],[\"Q\",797.8356311381716,765.1069312267443,801.8368441925024,765.1069312267443],[\"Q\",805.8380572468333,765.1069312267443,810.8395735647468,765.1069312267443],[\"Q\",815.8410898826604,765.1069312267443,820.842606200574,765.1069312267443],[\"Q\",825.8441225184874,765.1069312267443,829.8453355728183,765.1069312267443],[\"L\",833.8495486271491,765.1069312267443]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":692.3,\"top\":847.63,\"width\":148.05,\"height\":96.03,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",693.8040917255698,897.143957272739],[\"Q\",693.8040917255698,897.1469572727391,693.8040917255698,898.1472605003603],[\"Q\",693.8040917255698,899.1475637279815,693.8040917255698,901.1481701832238],[\"Q\",693.8040917255698,903.1487766384662,695.8046982527353,906.1496863213297],[\"Q\",697.8053047799007,909.1505960041932,700.8062145706488,914.1521121422991],[\"Q\",703.807124361397,919.1536282804049,708.8086406793104,924.1551444185108],[\"Q\",713.810156997224,929.1566605566167,717.8113700515548,933.1578734671014],[\"Q\",721.8125831058857,937.159086377586,725.8137961602165,940.1599960604495],[\"Q\",729.8150092145473,943.160905743313,732.8159190052954,944.1612089709342],[\"Q\",735.8168287960436,945.1615121985553,739.8180418503745,945.1615121985553],[\"Q\",743.8192549047053,945.1615121985553,747.8204679590361,945.1615121985553],[\"Q\",751.821681013367,945.1615121985553,756.8231973312805,945.1615121985553],[\"Q\",761.8247136491941,945.1615121985553,768.826836494273,944.1612089709342],[\"Q\",775.828959339352,943.160905743313,782.8310821844309,938.1593896052073],[\"Q\",789.8332050295099,933.1578734671014,796.835327874589,926.155750873753],[\"Q\",803.8374507196679,919.1536282804049,810.8395735647468,910.1508992318143],[\"Q\",817.8416964098258,901.1481701832238,822.8432127277393,893.1457443622544],[\"Q\",827.8447290456529,885.143318541285,830.845638836401,878.1411959479368],[\"Q\",833.8465486271491,871.1390733545886,836.8474584178973,865.1372539888616],[\"Q\",839.8483682086454,859.1354346231345,840.848671472228,854.1339184850287],[\"L\",841.8519747358108,849.1294023469228]]}]}";
      var canvasImage = "canvas.png";
      var fallbackImage = null;
      var fabricCanvas = null, saveTimer = null;
      var originalW = 600, originalH = 800; // defaults
      var editor = document.getElementById('editor');
      var saveStatus = document.getElementById('saveStatus');
      
      try { var saved = localStorage.getItem(STORAGE_KEY); if (saved) { var data = JSON.parse(saved); if (data.content) editor.value = data.content; } } catch(e){}
      
      function scheduleSave() {
        if (saveTimer) clearTimeout(saveTimer);
        saveTimer = setTimeout(function() {
          try { localStorage.setItem(STORAGE_KEY, JSON.stringify({ content: editor.value })); saveStatus.textContent = 'saved'; } catch(e){}
        }, 1000);
      }
      editor.addEventListener('input', function() { saveStatus.textContent = 'modified'; scheduleSave(); });
      
      function scaleCanvasToFit() {
        var container = document.getElementById('canvasContainer');
        var wrapper = document.getElementById('canvasWrapper');
        var rect = container.getBoundingClientRect();
        var containerW = rect.width - 20;
        var containerH = rect.height - 20;
        
        if (containerW <= 0 || containerH <= 0) return;
        
        var scaleX = containerW / originalW;
        var scaleY = containerH / originalH;
        var scale = Math.min(scaleX, scaleY, 1); // never scale up beyond 1
        
        wrapper.style.transform = 'scale(' + scale + ')';
      }
      
      function initCanvas() {
        // Get original dimensions from JSON if available
        if (canvasJson) {
          originalW = canvasJson.width || 600;
          originalH = canvasJson.height || 800;
        }
        
        var el = document.getElementById('fabricCanvas');
        el.width = originalW;
        el.height = originalH;
        
        fabricCanvas = new fabric.Canvas('fabricCanvas', { 
          width: originalW, 
          height: originalH, 
          backgroundColor: null 
        });
        fabricCanvas.freeDrawingBrush.width = 3;
        fabricCanvas.freeDrawingBrush.color = '#000000';
        
        if (canvasJson) {
          fabricCanvas.loadFromJSON(canvasJson, function() {
            fabricCanvas.renderAll();
            scaleCanvasToFit();
          });
        } else if (canvasImage || fallbackImage) {
          fabric.Image.fromURL(canvasImage || fallbackImage, function(img) {
            if (!img) return;
            img.set({ left: 0, top: 0, selectable: true });
            fabricCanvas.add(img);
            fabricCanvas.renderAll();
            scaleCanvasToFit();
          }, null, { crossOrigin: 'anonymous' });
        } else {
          scaleCanvasToFit();
        }
      }
      
      document.getElementById('selectBtn').onclick = function() { 
        if(fabricCanvas) { 
          fabricCanvas.isDrawingMode = false; 
          this.classList.add('active'); 
          document.getElementById('drawBtn').classList.remove('active'); 
        } 
      };
      document.getElementById('drawBtn').onclick = function() { 
        if(fabricCanvas) { 
          fabricCanvas.isDrawingMode = true; 
          this.classList.add('active'); 
          document.getElementById('selectBtn').classList.remove('active'); 
        } 
      };
      
      setTimeout(initCanvas, 150);
      
      window.addEventListener('resize', function() {
        scaleCanvasToFit();
      });
    })();
  </script>
</body>
</html>