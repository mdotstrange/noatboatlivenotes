<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AY maaaaan - Noat Boat</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f2f2f2; color: #111; height: 100vh; display: flex; flex-direction: column; }
    .topbar { display: flex; align-items: center; padding: 10px 14px; border-bottom: 1px solid #d9d9d9; background: #ffffff; gap: 12px; }
    .back-btn { padding: 6px 12px; border: 1px solid #d9d9d9; background: #ffffff; border-radius: 6px; cursor: pointer; font-size: 13px; color: #111; text-decoration: none; }
    .title { font-size: 16px; font-weight: 700; font-family: monospace; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .save-status { font-size: 12px; color: #666; font-family: monospace; }
    .main { display: flex; flex: 1; overflow: hidden; gap: 16px; padding: 14px; min-height: 0; }
    .editor-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; min-height: 0; }
    textarea { flex: 1; border: 1px solid #d9d9d9; border-radius: 12px; resize: none; padding: 14px; font-size: 14px; line-height: 1.55; font-family: monospace; background: #fff; color: #111; outline: none; }
    .canvas-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; min-height: 0; border: 1px solid #d9d9d9; border-radius: 12px; overflow: hidden; background: #fff; }
    .canvas-toolbar { display: flex; gap: 6px; padding: 8px 10px; border-bottom: 1px solid #d9d9d9; background: #ffffff; flex-shrink: 0; }
    .btn { padding: 5px 10px; border: 1px solid #d9d9d9; background: #ffffff; border-radius: 6px; cursor: pointer; font-size: 12px; color: #111; }
    .btn.active { background: #eef5ff; border-color: #c9dcff; }
    #canvasContainer { flex: 1; position: relative; overflow: hidden; min-height: 0; }
    #canvasContainer canvas { display: block; }
    #canvasContainer .canvas-container { position: absolute !important; }
    .audio-player { padding: 10px; border-top: 1px solid #d9d9d9; display: none; flex-shrink: 0; }
    .audio-player audio { width: 100%; }
    @media (max-width: 768px) { .main { flex-direction: column; } .editor-pane, .canvas-pane { flex: none; height: 45vh; } }
  </style>
</head>
<body>
  <div class="topbar">
    <a href="../index.html" class="back-btn">Back</a>
    <div class="title">AY maaaaan</div>
    <div class="save-status" id="saveStatus"></div>
  </div>
  <div class="main">
    <div class="editor-pane">
      <textarea id="editor" spellcheck="false">dnsad sfs dfs df sdf sdf sd f</textarea>
    </div>
    <div class="canvas-pane" id="canvasPane">
      <div class="canvas-toolbar">
        <button id="selectBtn" class="btn active">Select</button>
        <button id="drawBtn" class="btn">Draw</button>
      </div>
      <div id="canvasContainer">
        <canvas id="fabricCanvas"></canvas>
      </div>
      <div class="audio-player"><audio controls loop src=""></audio></div>
    </div>
  </div>
  <script>
    (function() {
      var STORAGE_KEY = 'noatboat_' + "ay-maaaaan";
      var canvasJson = "{\"version\":\"5.3.0\",\"objects\":[{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":104.13,\"top\":59.39,\"width\":290.09,\"height\":320.1,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",253.6736557491777,92.9031622653164],[\"Q\",253.6706557491777,92.9031622653164,251.6700492220123,92.9031622653164],[\"Q\",249.66944269484688,92.9031622653164,245.66822964051602,92.9031622653164],[\"Q\",241.66701658618518,92.9031622653164,234.66489374110623,92.9031622653164],[\"Q\",227.66277089602727,92.9031622653164,218.66004152378287,91.90285903769522],[\"Q\",209.6573121515385,90.90255581007405,200.65458277929412,90.90255581007405],[\"Q\",191.6518534070497,90.90255581007405,180.64851750763992,92.9031622653164],[\"Q\",169.64518160823013,94.90376872055874,160.64245223598573,97.90467840342225],[\"Q\",151.63972286374135,100.90558808628577,145.63790328224508,103.9064977691493],[\"Q\",139.63608370074883,106.90740745201282,134.6345673828353,110.90862036249752],[\"Q\",129.63305106492174,114.9098332729822,125.63183801059091,119.91134941108805],[\"Q\",121.63062495626006,124.91286554919392,118.62971516551194,128.9140784596786],[\"Q\",115.62880537476381,132.9152913701633,113.6281988475984,139.9174139635115],[\"Q\",111.62759232043298,146.91953655685973,111.62759232043298,155.92226560545026],[\"Q\",111.62759232043298,164.92499465404083,109.62698579326755,176.9286333854949],[\"Q\",107.62637926610213,188.93227211694895,106.62607600251943,205.93742698650888],[\"Q\",105.62577273893672,222.9425818560688,105.62577273893672,241.94834318087112],[\"Q\",105.62577273893672,260.9541045056734,105.62577273893672,276.9589561476122],[\"Q\",105.62577273893672,292.9638077895509,105.62577273893672,304.96744652100494],[\"Q\",105.62577273893672,316.97108525245903,105.62577273893672,322.9729046181861],[\"Q\",105.62577273893672,328.9747239839131,105.62577273893672,330.97533043915547],[\"Q\",105.62577273893672,332.9759368943978,106.62607600251943,333.976240122019],[\"Q\",107.62637926610213,334.97654334964017,112.62789558401568,336.9771498048825],[\"Q\",117.62941190192923,338.97775626012486,124.6315347470082,341.97866594298836],[\"Q\",131.63365759208716,344.97957562585185,142.63699349149698,348.98078853633655],[\"Q\",153.64032939090677,352.98200144682124,168.6448783446474,357.9835175849271],[\"Q\",183.64942729838805,362.985033723033,198.6539762521287,366.9862466335177],[\"Q\",213.65852520586932,370.9874595440024,224.66186110527912,373.98836922686587],[\"Q\",235.66519700468893,376.9892789097294,245.66822964051602,377.98958213735057],[\"Q\",255.67126227634313,378.9898853649717,266.6745981757529,379.99018859259286],[\"Q\",277.67793407516274,380.99049182021406,285.6803601838244,380.99049182021406],[\"Q\",293.68278629248607,380.99049182021406,301.68521240114774,380.99049182021406],[\"Q\",309.6876385098094,380.99049182021406,317.69006461847107,380.99049182021406],[\"Q\",325.6924907271328,380.99049182021406,331.69431030862904,379.99018859259286],[\"Q\",337.6961298901253,378.9898853649717,343.69794947162154,376.98927890972936],[\"Q\",349.6997690531178,374.9886724544871,354.7012853710313,370.9874595440024],[\"Q\",359.7028016889449,366.9862466335177,364.70431800685844,361.9847304954118],[\"Q\",369.705834324772,356.98321435730594,374.7073506426856,349.9810917639577],[\"Q\",379.7088669605991,342.9789691706095,382.70977675134725,332.9759368943978],[\"Q\",385.71068654209535,322.9729046181861,387.71129306926076,311.9695691143532],[\"Q\",389.7118995964262,300.9662336105203,391.7125061235916,286.96198842382387],[\"Q\",393.713112650757,272.95774323712743,394.71341591433975,251.9513754570828],[\"Q\",395.7137191779224,230.9450076770382,395.7137191779224,212.9395495798571],[\"Q\",395.7137191779224,194.934091482676,394.71341591433975,179.9295430683584],[\"Q\",393.713112650757,164.92499465404083,392.7128093871743,152.92135592258677],[\"Q\",391.7125061235916,140.91771719113268,389.7118995964262,134.91589782540564],[\"Q\",387.71129306926076,128.91407845967862,385.71068654209535,123.91256232157275],[\"Q\",383.71008001492993,118.91104618346688,381.7094734877645,114.90983327298218],[\"Q\",379.7088669605991,110.9086203624975,376.70795716985094,107.907710679634],[\"Q\",373.70704737910285,104.90680099677047,370.70613758835475,99.9052848586646],[\"Q\",367.7052277976066,94.90376872055874,362.703711479693,90.90255581007406],[\"Q\",357.70219516177946,86.90134289958937,354.7012853710313,82.90012998910467],[\"Q\",351.7003755802832,78.89891707861999,348.6994657895351,75.89800739575647],[\"Q\",345.69855599878696,72.89709771289294,342.6976462080388,71.89679448527177],[\"Q\",339.6967364172907,70.8964912576506,335.6955233629599,68.89588480240826],[\"Q\",331.69431030862904,66.89527834716591,325.6924907271328,64.89467189192356],[\"Q\",319.69067114563654,62.894065436681224,313.68885156414024,61.89376220906005],[\"Q\",307.687031982644,60.893458981438876,301.68521240114774,60.893458981438876],[\"Q\",295.6833928196515,60.893458981438876,289.68157323815524,60.893458981438876],[\"Q\",283.679753656659,60.893458981438876,277.67793407516274,60.893458981438876],[\"Q\",271.6761144936665,60.893458981438876,263.6736883850048,61.89376220906005],[\"Q\",255.67126227634313,62.894065436681224,247.66883616768143,65.89497511954474],[\"Q\",239.66641005901977,68.89588480240826,231.6639839503581,72.89709771289296],[\"Q\",223.66155784169644,76.89831062337764,217.65973826020019,80.89952353386232],[\"Q\",211.6579186787039,84.90073644434702,208.65700888795578,86.90134289958937],[\"Q\",205.65609909720766,88.90194935483171,203.65549257004224,89.90225258245289],[\"L\",201.65188604287684,90.90555581007405]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":168.14,\"top\":153.42,\"width\":38.02,\"height\":18.01,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",169.64218160823015,154.9189623778291],[\"Q\",169.64518160823013,154.9219623778291,169.64518160823013,155.92226560545026],[\"Q\",169.64518160823013,156.92256883307144,171.64578813539555,157.9228720606926],[\"Q\",173.64639466256097,158.9231752883138,176.6473044533091,160.92378174355613],[\"Q\",179.64821424405721,162.92438819879848,183.64942729838805,165.925297881662],[\"Q\",187.65064035271888,168.9262075645255,190.651550143467,169.92651079214667],[\"Q\",193.65245993421513,170.92681401976785,196.65336972496328,171.92711724738902],[\"Q\",199.6542795157114,172.9274204750102,200.65458277929412,172.9274204750102],[\"Q\",201.65488604287683,172.9274204750102,204.65579583362495,172.9274204750102],[\"L\",207.65970562437306,172.9274204750102]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":192.15,\"top\":161.42,\"width\":14.01,\"height\":8.01,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",207.65970562437306,162.92438819879848],[\"Q\",207.65670562437307,162.92438819879848,206.65640236079037,162.92438819879848],[\"Q\",205.65609909720766,162.92438819879848,203.65549257004224,162.92438819879848],[\"Q\",201.65488604287683,162.92438819879848,199.6542795157114,163.92469142641966],[\"Q\",197.653672988546,164.92499465404083,195.65306646138055,167.92590433690435],[\"L\",193.64945993421514,170.92981401976783]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":256.17,\"top\":161.42,\"width\":60.02,\"height\":0,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",257.66886880350853,162.92438819879848],[\"Q\",257.6718688035085,162.92438819879848,258.67217206709125,162.92438819879848],[\"Q\",259.672475330674,162.92438819879848,261.6730818578394,162.92438819879848],[\"Q\",263.6736883850048,162.92438819879848,269.6755079665011,162.92438819879848],[\"Q\",275.6773275479973,162.92438819879848,283.679753656659,162.92438819879848],[\"Q\",291.68217976532065,162.92438819879848,298.68430261039964,162.92438819879848],[\"Q\",305.68642545547857,162.92438819879848,311.6882450369749,162.92438819879848],[\"L\",317.6930646184711,162.92438819879848]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":206.15,\"top\":257.45,\"width\":144.05,\"height\":0,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",207.6537056243731,258.95349805043105],[\"Q\",207.65670562437307,258.95349805043105,208.65700888795578,258.95349805043105],[\"Q\",209.6573121515385,258.95349805043105,217.65973826020019,258.95349805043105],[\"Q\",225.66216436886185,258.95349805043105,241.66701658618518,258.95349805043105],[\"Q\",257.6718688035085,258.95349805043105,273.6767210208319,258.95349805043105],[\"Q\",289.68157323815524,258.95349805043105,303.6858189283132,258.95349805043105],[\"Q\",317.6900646184711,258.95349805043105,327.6930972542982,258.95349805043105],[\"Q\",337.6961298901253,258.95349805043105,342.6976462080388,258.95349805043105],[\"Q\",347.6991625259524,258.95349805043105,349.6997690531178,258.95349805043105],[\"L\",351.7033755802832,258.95349805043105]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":930.38,\"top\":1345.78,\"width\":298.09,\"height\":366.11,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",1161.9490190822778,1347.2834097022667],[\"Q\",1161.9460190822779,1347.2834097022667,1157.944806027947,1347.2834097022667],[\"Q\",1153.9435929736162,1347.2834097022667,1149.9423799192855,1347.2834097022667],[\"Q\",1145.9411668649545,1347.2834097022667,1136.9384374927101,1347.2834097022667],[\"Q\",1127.9357081204657,1347.2834097022667,1116.932372221056,1347.2834097022667],[\"Q\",1105.9290363216462,1347.2834097022667,1090.9244873679054,1347.2834097022667],[\"Q\",1075.9199384141648,1347.2834097022667,1059.9150861968415,1349.284016157509],[\"Q\",1043.9102339795181,1351.2846226127515,1030.906291552943,1355.285835523236],[\"Q\",1017.9023491263677,1359.2870484337209,1008.8996197541233,1363.2882613442057],[\"Q\",999.8968903818788,1367.2894742546903,991.8944642732172,1374.2915968480384],[\"Q\",983.8920381645555,1381.2937194413867,976.8899153194766,1389.296145262356],[\"Q\",969.8877924743977,1397.2985710833254,965.8865794200668,1406.301300131916],[\"Q\",961.885366365736,1415.3040291805064,956.8838500478224,1425.3070614567182],[\"Q\",951.8823337299089,1435.31009373293,947.881120675578,1447.313732464384],[\"Q\",943.8799076212472,1459.317371195838,940.878997830499,1471.321009927292],[\"Q\",937.8780880397509,1483.3246486587461,936.8777847761683,1494.327984162579],[\"Q\",935.8774815125855,1505.331319666412,933.87687498542,1519.3355648531083],[\"Q\",931.8762684582547,1533.339810039805,931.8762684582547,1545.3434487712589],[\"Q\",931.8762684582547,1557.347087502713,931.8762684582547,1569.350726234167],[\"Q\",931.8762684582547,1581.354364965621,931.8762684582547,1592.357700469454],[\"Q\",931.8762684582547,1603.3610359732868,934.8771782490028,1614.3643714771197],[\"Q\",937.8780880397509,1625.3677069809528,942.8796043576644,1635.3707392571646],[\"Q\",947.881120675578,1645.3737715333762,952.8826369934916,1653.3761973543455],[\"Q\",957.8841533114052,1661.378623175315,962.8856696293187,1667.380442541042],[\"Q\",967.8871859472322,1673.382261906769,974.8893087923111,1677.3834748172535],[\"Q\",981.8914316373902,1681.3846877277383,987.8932512188865,1685.3859006382231],[\"Q\",993.8950708003827,1689.3871135487077,1000.8971936454616,1692.3880232315712],[\"Q\",1007.8993164905406,1695.3889329144347,1015.9017425992023,1698.3898425972984],[\"Q\",1023.904168707864,1701.390752280162,1033.907201343691,1703.391358735404],[\"Q\",1043.9102339795181,1705.3919651906465,1051.9126600881798,1707.392571645889],[\"Q\",1059.9150861968415,1709.3931781011313,1068.9178155690859,1710.3934813287524],[\"Q\",1077.9205449413303,1711.3937845563735,1086.9232743135747,1712.3940877839946],[\"Q\",1095.926003685819,1713.3943910116159,1103.9284297944807,1713.3943910116159],[\"Q\",1111.9308559031424,1713.3943910116159,1120.9335852753868,1712.3940877839946],[\"Q\",1129.9363146476312,1711.3937845563735,1137.9387407562929,1709.393178101131],[\"Q\",1145.9411668649545,1707.392571645889,1152.9432897100335,1702.391055507783],[\"Q\",1159.9454125551124,1697.389539369677,1165.9472321366088,1693.3883264591923],[\"Q\",1171.949051718105,1689.3871135487077,1176.9505680360185,1684.3855974106018],[\"Q\",1181.952084353932,1679.384081272496,1185.9532974082626,1672.3819586791478],[\"Q\",1189.9545104625936,1665.3798360857995,1194.9560267805073,1658.3777134924512],[\"Q\",1199.9575430984207,1651.3755908991031,1202.9584528891687,1643.3731650781338],[\"Q\",1205.959362679917,1635.3707392571644,1208.9602724706651,1626.3680102085739],[\"Q\",1211.9611822614133,1617.3652811599834,1214.9620920521616,1608.3625521113927],[\"Q\",1217.9630018429095,1599.3598230628022,1220.9639116336575,1589.3567907865904],[\"Q\",1223.9648214244057,1579.3537585103788,1225.9654279515712,1568.350423006546],[\"Q\",1227.9660344787367,1557.347087502713,1228.9663377423194,1548.3443584541224],[\"Q\",1229.9666410059021,1539.3416294055319,1229.9666410059021,1529.33859712932],[\"Q\",1229.9666410059021,1519.3355648531085,1229.9666410059021,1510.3328358045178],[\"Q\",1229.9666410059021,1501.3301067559273,1229.9666410059021,1494.327984162579],[\"Q\",1229.9666410059021,1487.325861569231,1229.9666410059021,1480.3237389758829],[\"Q\",1229.9666410059021,1473.3216163825346,1229.9666410059021,1466.3194937891863],[\"Q\",1229.9666410059021,1459.317371195838,1228.9663377423194,1453.315551830111],[\"Q\",1227.9660344787367,1447.313732464384,1225.9654279515712,1441.311913098657],[\"Q\",1223.9648214244057,1435.31009373293,1220.9639116336575,1430.308577594824],[\"Q\",1217.9630018429095,1425.3070614567182,1215.9623953157443,1421.3058485462334],[\"Q\",1213.9617887885788,1417.3046356357488,1211.9611822614133,1412.303119497643],[\"Q\",1209.9605757342479,1407.301603359537,1206.9596659434997,1404.3006936766735],[\"Q\",1203.9587561527517,1401.29978399381,1202.958452889169,1399.2991775385676],[\"Q\",1201.9581496255862,1397.2985710833254,1199.9575430984207,1396.2982678557041],[\"Q\",1197.9569365712553,1395.297964628083,1196.9566333076727,1394.297661400462],[\"Q\",1195.95633004409,1393.2973581728406,1192.9554202533418,1393.2973581728406],[\"Q\",1189.9545104625936,1393.2973581728406,1186.9536006718454,1393.2973581728406],[\"Q\",1183.9526908810974,1393.2973581728406,1178.951174563184,1392.2970549452193],[\"Q\",1173.9496582452703,1391.2967517175982,1167.947838663774,1390.2964484899771],[\"Q\",1161.9460190822779,1389.296145262356,1154.9438962371987,1388.295842034735],[\"Q\",1147.9417733921198,1387.2955388071136,1137.9387407562926,1386.2952355794923],[\"Q\",1127.9357081204657,1385.2949323518712,1115.9320689574733,1385.2949323518712],[\"Q\",1103.9284297944807,1385.2949323518712,1092.9250938950709,1384.2946291242502],[\"Q\",1081.921757995661,1383.2943258966288,1070.918422096251,1382.2940226690077],[\"L\",1059.9120861968415,1381.2907194413867]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":1054.41,\"top\":1335.78,\"width\":4,\"height\":320.1,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",1059.9150861968415,1337.2773774260552],[\"Q\",1059.9150861968415,1337.280377426055,1059.9150861968415,1338.2806806536762],[\"Q\",1059.9150861968415,1339.2809838812973,1059.9150861968415,1341.2815903365397],[\"Q\",1059.9150861968415,1343.282196791782,1059.9150861968415,1352.2849258403726],[\"Q\",1059.9150861968415,1361.287654888963,1059.9150861968415,1379.2931129861443],[\"Q\",1059.9150861968415,1397.2985710833254,1059.9150861968415,1418.30493886337],[\"Q\",1059.9150861968415,1439.3113066434146,1059.9150861968415,1460.3176744234593],[\"Q\",1059.9150861968415,1481.324042203504,1059.9150861968415,1497.3288938454425],[\"Q\",1059.9150861968415,1513.3337454873813,1059.9150861968415,1523.336777763593],[\"Q\",1059.9150861968415,1533.339810039805,1059.9150861968415,1540.3419326331532],[\"Q\",1059.9150861968415,1547.3440552265013,1059.9150861968415,1551.3452681369859],[\"Q\",1059.9150861968415,1555.3464810474707,1059.9150861968415,1557.3470875027128],[\"Q\",1059.9150861968415,1559.3476939579552,1059.9150861968415,1560.3479971855763],[\"Q\",1059.9150861968415,1561.3483004131976,1059.9150861968415,1562.348603640819],[\"Q\",1059.9150861968415,1563.34890686844,1059.9150861968415,1564.3492100960611],[\"Q\",1059.9150861968415,1565.3495133236825,1059.9150861968415,1566.3498165513035],[\"Q\",1059.9150861968415,1567.3501197789246,1059.9150861968415,1568.350423006546],[\"Q\",1059.9150861968415,1569.350726234167,1059.9150861968415,1572.3516359170305],[\"Q\",1059.9150861968415,1575.352545599894,1059.9150861968415,1578.3534552827575],[\"Q\",1059.9150861968415,1581.354364965621,1059.9150861968415,1585.3555778761056],[\"Q\",1059.9150861968415,1589.3567907865904,1059.9150861968415,1593.3580036970752],[\"Q\",1059.9150861968415,1597.3592166075598,1059.9150861968415,1602.3607327456657],[\"Q\",1059.9150861968415,1607.3622488837716,1059.9150861968415,1610.363158566635],[\"Q\",1059.9150861968415,1613.3640682494986,1059.9150861968415,1615.364674704741],[\"Q\",1059.9150861968415,1617.3652811599834,1059.9150861968415,1619.3658876152258],[\"Q\",1059.9150861968415,1621.366494070468,1059.9150861968415,1622.3667972980893],[\"Q\",1059.9150861968415,1623.3671005257104,1059.9150861968415,1624.3674037533315],[\"Q\",1059.9150861968415,1625.3677069809528,1058.9147829332587,1626.3680102085739],[\"Q\",1057.914479669676,1627.368313436195,1057.914479669676,1629.3689198914374],[\"Q\",1057.914479669676,1631.3695263466798,1057.914479669676,1633.370132801922],[\"Q\",1057.914479669676,1635.3707392571644,1057.914479669676,1638.3716489400279],[\"Q\",1057.914479669676,1641.3725586228913,1057.914479669676,1643.3731650781338],[\"Q\",1057.914479669676,1645.3737715333762,1057.914479669676,1647.3743779886186],[\"Q\",1057.914479669676,1649.3749844438607,1056.9141764060932,1651.3755908991031],[\"Q\",1055.9138731425107,1653.3761973543455,1055.9138731425107,1655.3768038095877],[\"L\",1055.9138731425107,1657.38041026483]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":912.71,\"top\":1531.84,\"width\":325.76,\"height\":4,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",915.8684162409313,1535.340416495047],[\"Q\",915.8714162409314,1535.340416495047,914.8711129773486,1534.340113267426],[\"Q\",913.8708097137659,1533.339810039805,915.8714162409312,1533.339810039805],[\"Q\",917.8720227680967,1533.339810039805,924.8741456131756,1533.339810039805],[\"Q\",931.8762684582547,1533.339810039805,944.8802108848299,1533.339810039805],[\"Q\",957.8841533114052,1533.339810039805,974.8893087923111,1533.339810039805],[\"Q\",991.8944642732172,1533.339810039805,1013.9011360720368,1533.339810039805],[\"Q\",1035.9078078708565,1533.339810039805,1058.9147829332587,1533.339810039805],[\"Q\",1081.921757995661,1533.339810039805,1098.926913476567,1533.339810039805],[\"Q\",1115.9320689574731,1533.339810039805,1128.9360113840485,1533.339810039805],[\"Q\",1141.9399538106236,1533.339810039805,1152.9432897100335,1533.339810039805],[\"Q\",1163.9466256094433,1533.339810039805,1171.949051718105,1533.339810039805],[\"Q\",1179.9514778267667,1533.339810039805,1185.9532974082629,1533.339810039805],[\"Q\",1191.955116989759,1533.339810039805,1196.9566333076727,1534.340113267426],[\"Q\",1201.9581496255862,1535.340416495047,1205.959362679917,1535.340416495047],[\"Q\",1209.9605757342479,1535.340416495047,1211.9611822614133,1536.3407197226684],[\"Q\",1213.9617887885788,1537.3410229502895,1216.962698579327,1537.3410229502895],[\"Q\",1219.963608370075,1537.3410229502895,1220.9639116336577,1537.3410229502895],[\"Q\",1221.9642148972405,1537.3410229502895,1222.964518160823,1537.3410229502895],[\"Q\",1223.9648214244057,1537.3410229502895,1224.9651246879885,1537.3410229502895],[\"Q\",1225.9654279515712,1537.3410229502895,1227.9660344787367,1537.3410229502895],[\"Q\",1229.9666410059021,1537.3410229502895,1230.9669442694849,1537.3410229502895],[\"Q\",1231.9672475330674,1537.3410229502895,1232.9675507966501,1537.3410229502895],[\"Q\",1233.9678540602329,1537.3410229502895,1236.9687638509808,1537.3410229502895],[\"L\",1239.972673641729,1537.3410229502895]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":718.31,\"top\":429.5,\"width\":72.02,\"height\":924.29,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",719.8119765787203,431.0026532012727],[\"Q\",719.8119765787203,431.0056532012727,719.8119765787203,432.0059564288939],[\"Q\",719.8119765787203,433.00625965651506,719.8119765787203,435.0068661117574],[\"Q\",719.8119765787203,437.00747256699975,719.8119765787203,450.011414526075],[\"Q\",719.8119765787203,463.0153564851502,719.8119765787203,495.02505976902773],[\"Q\",719.8119765787203,527.0347630529053,729.8150092145474,632.0666019531284],[\"Q\",739.8180418503745,737.0984408533515,747.8204679590361,790.1145119172736],[\"Q\",755.8228940676978,843.1305829811957,761.8247136491941,889.1445314517697],[\"Q\",767.8265332306903,935.1584799223436,773.8283528121865,980.1721251652964],[\"Q\",779.8301723936828,1025.1857704082493,782.8310821844309,1051.1936543263996],[\"Q\",785.8319919751791,1077.2015382445502,786.8322952387618,1094.20669311411],[\"Q\",787.8325985023445,1111.21184798367,788.8329017659272,1123.215486715124],[\"Q\",789.8332050295099,1135.2191254465781,790.8335082930926,1140.220641584684],[\"Q\",791.8338115566753,1145.22215772279,791.8338115566753,1148.2230674056534],[\"Q\",791.8338115566753,1151.223977088517,791.8338115566753,1153.2245835437593],[\"Q\",791.8338115566753,1155.2251899990017,791.8338115566753,1156.2254932266228],[\"Q\",791.8338115566753,1157.225796454244,791.8338115566753,1158.226099681865],[\"Q\",791.8338115566753,1159.2264029094863,791.8338115566753,1161.2270093647287],[\"Q\",791.8338115566753,1163.227615819971,791.8338115566753,1166.2285255028346],[\"Q\",791.8338115566753,1169.229435185698,791.8338115566753,1172.2303448685616],[\"Q\",791.8338115566753,1175.231254551425,791.8338115566753,1180.232770689531],[\"Q\",791.8338115566753,1185.2342868276369,791.8338115566753,1190.2358029657426],[\"Q\",791.8338115566753,1195.2373191038484,791.8338115566753,1198.238228786712],[\"Q\",791.8338115566753,1201.2391384695754,791.8338115566753,1205.24035138006],[\"Q\",791.8338115566753,1209.2415642905448,791.8338115566753,1213.2427772010296],[\"Q\",791.8338115566753,1217.2439901115142,791.8338115566753,1220.244899794378],[\"Q\",791.8338115566753,1223.2458094772414,791.8338115566753,1226.246719160105],[\"Q\",791.8338115566753,1229.2476288429684,791.8338115566753,1231.2482352982106],[\"Q\",791.8338115566753,1233.248841753453,791.8338115566753,1234.249144981074],[\"Q\",791.8338115566753,1235.2494482086954,791.8338115566753,1236.2497514363167],[\"Q\",791.8338115566753,1237.2500546639378,791.8338115566753,1239.2506611191802],[\"Q\",791.8338115566753,1241.2512675744224,791.8338115566753,1246.2527837125283],[\"Q\",791.8338115566753,1251.2542998506342,791.8338115566753,1260.2570288992247],[\"Q\",791.8338115566753,1269.2597579478154,791.8338115566753,1280.2630934516483],[\"Q\",791.8338115566753,1291.2664289554812,791.8338115566753,1302.269764459314],[\"Q\",791.8338115566753,1313.273099963147,791.8338115566753,1323.2761322393585],[\"Q\",791.8338115566753,1333.2791645155703,791.8338115566753,1340.2812871089186],[\"Q\",791.8338115566753,1347.2834097022667,790.8335082930926,1351.2846226127513],[\"L\",789.8302050295099,1355.288835523236]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":120.13,\"top\":783.61,\"width\":1116.34,\"height\":60.02,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",121.62762495626006,845.1341894364382],[\"Q\",121.63062495626006,845.1311894364381,123.6312314834255,845.1311894364381],[\"Q\",125.63183801059091,845.1311894364381,138.63578043716615,842.1302797535745],[\"Q\",151.63972286374135,839.129370070711,181.64882077122263,831.1269442497417],[\"Q\",211.6579186787039,823.1245184287724,260.67277859425667,814.1217893801818],[\"Q\",309.6876385098094,805.1190603315912,377.7082604334337,798.116937738243],[\"Q\",445.7288823570579,791.1148151448948,507.7476846991859,788.1139054620313],[\"Q\",569.7664870413139,785.1129957791678,619.7816502204494,785.1129957791678],[\"Q\",669.7968133995848,785.1129957791678,715.8107635243895,785.1129957791678],[\"Q\",761.8247136491941,785.1129957791678,797.8356311381716,785.1129957791678],[\"Q\",833.8465486271491,785.1129957791678,858.8541302167168,785.1129957791678],[\"Q\",883.8617118062846,785.1129957791678,903.8677770779389,786.113299006789],[\"Q\",923.873842349593,787.1136022344101,960.8850631021533,791.1148151448948],[\"Q\",997.8962838547135,795.1160280553795,1014.9014393356194,798.116937738243],[\"Q\",1031.9065948165255,801.1178474211065,1049.9120535610143,802.1181506487277],[\"Q\",1067.9175123055031,803.1184538763489,1083.9223645228265,805.1190603315913],[\"Q\",1099.9272167401498,807.1196667868336,1111.9308559031424,809.1202732420759],[\"Q\",1123.9344950661348,811.1208796973183,1133.937527701962,812.1211829249394],[\"Q\",1143.940560337789,813.1214861525606,1153.9435929736162,814.1217893801818],[\"Q\",1163.9466256094433,815.122092607803,1170.9487484545223,815.122092607803],[\"Q\",1177.9508712996012,815.122092607803,1182.952387617515,815.122092607803],[\"Q\",1187.9539039354283,815.122092607803,1190.9548137261763,815.122092607803],[\"Q\",1193.9557235169245,815.122092607803,1196.9566333076727,815.122092607803],[\"Q\",1199.9575430984207,815.122092607803,1201.9581496255862,816.1223958354242],[\"Q\",1203.9587561527517,817.1226990630453,1205.959362679917,817.1226990630453],[\"Q\",1207.9599692070824,817.1226990630453,1208.9602724706651,817.1226990630453],[\"Q\",1209.9605757342479,817.1226990630453,1210.9608789978306,817.1226990630453],[\"Q\",1211.9611822614133,817.1226990630453,1212.961485524996,817.1226990630453],[\"Q\",1213.9617887885788,817.1226990630453,1214.9620920521616,817.1226990630453],[\"Q\",1215.962395315744,817.1226990630453,1216.9626985793268,817.1226990630453],[\"Q\",1217.9630018429095,817.1226990630453,1218.9633051064923,817.1226990630453],[\"Q\",1219.963608370075,817.1226990630453,1219.963608370075,818.1230022906665],[\"Q\",1219.963608370075,819.1233055182877,1220.9639116336577,819.1233055182877],[\"Q\",1221.9642148972405,819.1233055182877,1222.964518160823,819.1233055182877],[\"Q\",1223.9648214244057,819.1233055182877,1225.9654279515712,820.1236087459088],[\"Q\",1227.9660344787367,821.12391197353,1229.9666410059021,821.12391197353],[\"Q\",1231.9672475330674,821.12391197353,1234.9681573238156,822.1242152011512],[\"L\",1237.9720671145637,823.1275184287724]]}]}";
      var canvasImage = "canvas.png";
      var fallbackImage = null;
      var fabricCanvas = null, saveTimer = null;
      var editor = document.getElementById('editor');
      var saveStatus = document.getElementById('saveStatus');
      
      try { var saved = localStorage.getItem(STORAGE_KEY); if (saved) { var data = JSON.parse(saved); if (data.content) editor.value = data.content; } } catch(e){}
      
      function scheduleSave() {
        if (saveTimer) clearTimeout(saveTimer);
        saveTimer = setTimeout(function() {
          try { localStorage.setItem(STORAGE_KEY, JSON.stringify({ content: editor.value })); saveStatus.textContent = 'saved'; } catch(e){}
        }, 1000);
      }
      editor.addEventListener('input', function() { saveStatus.textContent = 'modified'; scheduleSave(); });
      
      function fitCanvasViewport(padding = 24) {
        if (!fabricCanvas) return;

        var objects = fabricCanvas.getObjects();
        if (!objects || objects.length === 0) {
          fabricCanvas.setViewportTransform([1, 0, 0, 1, 0, 0]);
          fabricCanvas.requestRenderAll();
          return;
        }

        // Compute overall bounds in canvas coords (include transforms)
        var minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
        objects.forEach(function(obj) {
          var r = obj.getBoundingRect(true, true);
          minX = Math.min(minX, r.left);
          minY = Math.min(minY, r.top);
          maxX = Math.max(maxX, r.left + r.width);
          maxY = Math.max(maxY, r.top + r.height);
        });

        var contentW = Math.max(1, maxX - minX);
        var contentH = Math.max(1, maxY - minY);

        var cw = fabricCanvas.getWidth();
        var ch = fabricCanvas.getHeight();

        var availW = Math.max(1, cw - padding * 2);
        var availH = Math.max(1, ch - padding * 2);

        var scale = Math.min(availW / contentW, availH / contentH);

        // Center content
        var contentCx = minX + contentW / 2;
        var contentCy = minY + contentH / 2;
        var tx = (cw / 2) - (contentCx * scale);
        var ty = (ch / 2) - (contentCy * scale);

        fabricCanvas.setViewportTransform([scale, 0, 0, scale, tx, ty]);
        fabricCanvas.requestRenderAll();
      }
      
      function initCanvas() {
        var container = document.getElementById('canvasContainer');
        var rect = container.getBoundingClientRect();
        var width = Math.max(Math.floor(rect.width), 400);
        var height = Math.max(Math.floor(rect.height), 300);
        
        var el = document.getElementById('fabricCanvas');
        el.width = width;
        el.height = height;
        
        fabricCanvas = new fabric.Canvas('fabricCanvas', { 
          width: width, 
          height: height, 
          backgroundColor: null 
        });
        fabricCanvas.freeDrawingBrush.width = 3;
        fabricCanvas.freeDrawingBrush.color = '#000000';
        
        if (canvasJson) {
          fabricCanvas.loadFromJSON(canvasJson, function() {
            fitCanvasViewport();
            fabricCanvas.renderAll();
          });
        } else if (canvasImage || fallbackImage) {
          fabric.Image.fromURL(canvasImage || fallbackImage, function(img) {
            if (!img) return;
            img.set({ left: 0, top: 0, selectable: true });
            fabricCanvas.add(img);
            fabricCanvas.renderAll();
            fitCanvasViewport();
          }, null, { crossOrigin: 'anonymous' });
        }
      }
      
      document.getElementById('selectBtn').onclick = function() { 
        if(fabricCanvas) { 
          fabricCanvas.isDrawingMode = false; 
          this.classList.add('active'); 
          document.getElementById('drawBtn').classList.remove('active'); 
        } 
      };
      document.getElementById('drawBtn').onclick = function() { 
        if(fabricCanvas) { 
          fabricCanvas.isDrawingMode = true; 
          this.classList.add('active'); 
          document.getElementById('selectBtn').classList.remove('active'); 
        } 
      };
      
      setTimeout(initCanvas, 150);
      
      window.addEventListener('resize', function() {
        if (!fabricCanvas) return;
        var container = document.getElementById('canvasContainer');
        var rect = container.getBoundingClientRect();
        if (rect.width > 0 && rect.height > 0) {
          fabricCanvas.setDimensions({ width: rect.width, height: rect.height });
          fitCanvasViewport();
        }
      });
    })();
  </script>
</body>
</html>