<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Noat Boat Export fixes - Noat Boat</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f2f2f2; color: #111; height: 100vh; display: flex; flex-direction: column; }
    .topbar { display: flex; align-items: center; padding: 10px 14px; border-bottom: 1px solid #d9d9d9; background: #ffffff; gap: 12px; }
    .back-btn { padding: 6px 12px; border: 1px solid #d9d9d9; background: #ffffff; border-radius: 6px; cursor: pointer; font-size: 13px; color: #111; text-decoration: none; }
    .title { font-size: 16px; font-weight: 700; font-family: monospace; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .save-status { font-size: 12px; color: #666; font-family: monospace; }
    .main { display: flex; flex: 1; overflow: hidden; gap: 16px; padding: 14px; min-height: 0; }
    .editor-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; min-height: 0; }
    textarea { flex: 1; border: 1px solid #d9d9d9; border-radius: 12px; resize: none; padding: 14px; font-size: 14px; line-height: 1.55; font-family: monospace; background: #fff; color: #111; outline: none; }
    .canvas-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; min-height: 0; border: 1px solid #d9d9d9; border-radius: 12px; overflow: hidden; background: #fff; }
    .canvas-toolbar { display: flex; gap: 6px; padding: 8px 10px; border-bottom: 1px solid #d9d9d9; background: #ffffff; flex-shrink: 0; }
    .btn { padding: 5px 10px; border: 1px solid #d9d9d9; background: #ffffff; border-radius: 6px; cursor: pointer; font-size: 12px; color: #111; }
    .btn.active { background: #eef5ff; border-color: #c9dcff; }
    #canvasContainer { flex: 1; position: relative; overflow: hidden; min-height: 0; display: flex; align-items: center; justify-content: center; }
    .canvas-wrapper { transform-origin: center center; display: inline-block; }
    .audio-player { padding: 10px; border-top: 1px solid #d9d9d9; display: none; flex-shrink: 0; }
    .audio-player audio { width: 100%; }
    @media (max-width: 768px) { .main { flex-direction: column; } .editor-pane, .canvas-pane { flex: none; height: 45vh; } }
  </style>
</head>
<body>
  <div class="topbar">
    <a href="../index.html" class="back-btn">Back</a>
    <div class="title">Noat Boat Export fixes</div>
    <div class="save-status" id="saveStatus"></div>
  </div>
  <div class="main">
    <div class="editor-pane">
      <textarea id="editor" spellcheck="false">* improve the look of the github export html
  * add boat to the top</textarea>
    </div>
    <div class="canvas-pane" id="canvasPane">
      <div class="canvas-toolbar">
        <button id="selectBtn" class="btn active">Select</button>
        <button id="drawBtn" class="btn">Draw</button>
      </div>
      <div id="canvasContainer">
        <div class="canvas-wrapper" id="canvasWrapper">
          <canvas id="fabricCanvas"></canvas>
        </div>
      </div>
      <div class="audio-player"><audio controls loop src=""></audio></div>
    </div>
  </div>
  <script>
    (function() {
      var STORAGE_KEY = 'noatboat_' + "noat-boat-export-fixes";
      var canvasJson = "{\"version\":\"5.3.0\",\"objects\":[{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":304.53,\"top\":387.49,\"width\":659.86,\"height\":830.25,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",809.8422703011641,388.99291764118345],[\"Q\",809.8392703011641,388.99291764118345,808.8389670375814,388.99291764118345],[\"Q\",807.8386637739987,388.99291764118345,804.8377539832506,388.99291764118345],[\"Q\",801.8368441925024,388.99291764118345,790.8335082930926,388.99291764118345],[\"Q\",779.8301723936828,388.99291764118345,752.8219842769497,391.99382732404695],[\"Q\",725.8137961602165,394.9947370069105,680.8001492989946,406.99837573836453],[\"Q\",635.7865024377727,419.0020144698186,592.7734621037162,436.00716933937855],[\"Q\",549.7604217696597,453.0123242089385,512.7492010170995,470.0174790784984],[\"Q\",475.7379802645392,487.02263394805834,441.72766930272707,506.0283952728606],[\"Q\",407.7173583409149,525.0341565976629,387.71129306926076,538.0380985567381],[\"Q\",367.7052277976066,551.0420405158134,355.70158863461404,561.0450727920252],[\"Q\",343.69794947162154,571.0481050682369,335.6955233629599,583.0517437996909],[\"Q\",327.6930972542982,595.055382531145,322.69158093638464,610.0599309454626],[\"Q\",317.6900646184711,625.0644793597802,314.689154827723,645.0705439122037],[\"Q\",311.6882450369749,665.076608464627,309.6876385098094,702.0878278866105],[\"Q\",307.687031982644,739.0990473085939,306.6867287190613,794.1157248277584],[\"Q\",305.68642545547857,849.1324023469228,307.687031982644,902.148473410845],[\"Q\",309.6876385098094,955.1645444747671,314.689154827723,992.1757638967505],[\"Q\",319.69067114563654,1029.1869833187338,325.6924907271328,1054.194564009263],[\"Q\",331.69431030862904,1079.2021446997926,336.6958266265426,1093.206389886489],[\"Q\",341.6973429444561,1107.2106350731854,343.69794947162154,1111.21184798367],[\"Q\",345.69855599878696,1115.2130608941548,348.6994657895351,1115.2130608941548],[\"Q\",351.7003755802832,1115.2130608941548,359.7028016889449,1118.2139705770182],[\"Q\",367.7052277976066,1121.2148802598817,380.7091702241818,1129.2173060808511],[\"Q\",393.713112650757,1137.2197319018205,413.7191779224112,1147.2227641780323],[\"Q\",433.7252431940654,1157.225796454244,457.73252152005045,1167.2288287304557],[\"Q\",481.73979984603545,1177.2318610066675,510.748594489934,1187.234893282879],[\"Q\",539.7573891338326,1197.2379255590909,572.767396832062,1203.2397449248178],[\"Q\",605.7774045302914,1209.2415642905448,638.7874122285208,1213.2427772010296],[\"Q\",671.7974199267502,1217.2439901115142,696.8050015163179,1218.2442933391353],[\"Q\",721.8125831058857,1219.2445965667566,735.8168287960436,1219.2445965667566],[\"Q\",749.8210744862016,1219.2445965667566,758.8238038584459,1219.2445965667566],[\"Q\",767.8265332306903,1219.2445965667566,769.8271397578558,1218.2442933391353],[\"Q\",771.8277462850211,1217.2439901115142,772.8280495486039,1216.2436868838931],[\"Q\",773.8283528121866,1215.243383656272,777.8295658665174,1203.2397449248178],[\"Q\",781.8307789208483,1191.2361061933639,789.8332050295099,1170.2297384133192],[\"Q\",797.8356311381716,1149.2233706332745,806.838360510416,1128.21700285323],[\"Q\",815.8410898826604,1107.2106350731854,828.8450323092356,1077.2015382445502],[\"Q\",841.8489747358108,1047.192441415915,858.8541302167168,1011.1815252215529],[\"Q\",875.8592856976229,975.1706090271906,889.8635313877809,944.1612089709342],[\"Q\",903.8677770779389,913.1518089146779,914.8711129773486,889.1445314517698],[\"Q\",925.8744488767584,865.1372539888616,933.87687498542,846.1314926640594],[\"Q\",941.8793010940817,827.1257313392571,947.881120675578,809.1202732420759],[\"Q\",953.8829402570743,791.1148151448948,957.8841533114052,774.1096602753348],[\"Q\",961.885366365736,757.104505405775,962.8856696293187,744.1005634466997],[\"Q\",963.8859728929013,731.0966214876245,964.8862761564841,721.0935892114128],[\"Q\",965.8865794200668,711.090556935201,965.8865794200668,702.0878278866105],[\"Q\",965.8865794200668,693.0850988380199,964.8862761564841,685.0826730170505],[\"Q\",963.8859728929013,677.0802471960811,961.885366365736,668.0775181474905],[\"Q\",959.8847598385705,659.0747890989,955.8835467842397,650.0720600503096],[\"Q\",951.8823337299089,641.069331001719,948.8814239391606,633.0669051807496],[\"Q\",945.8805141484125,625.0644793597802,941.8793010940817,616.0617503111896],[\"Q\",937.8780880397509,607.0590212625991,932.8765717218373,598.0562922140085],[\"Q\",927.8750554039239,589.0535631654179,921.8732358224277,581.0511373444485],[\"Q\",915.8714162409314,573.0487115234793,908.8692933958523,563.0456792472676],[\"Q\",901.8671705507734,553.0426469710558,895.8653509692772,546.0405243777076],[\"Q\",889.8635313877809,539.0384017843594,883.8617118062846,533.0365824186324],[\"Q\",877.8598922247884,527.0347630529053,872.8583759068748,524.0338533700417],[\"Q\",867.8568595889612,521.0329436871782,863.8556465346304,518.0320340043147],[\"Q\",859.8544334802996,515.0311243214512,852.8523106352206,514.03082109383],[\"Q\",845.8501877901416,513.0305178662088,837.8477616814799,513.0305178662088],[\"Q\",829.8453355728183,513.0305178662088,820.842606200574,513.0305178662088],[\"Q\",811.8398768283296,513.0305178662088,801.8368441925024,513.0305178662088],[\"Q\",791.8338115566753,513.0305178662088,781.8307789208482,513.0305178662088],[\"Q\",771.8277462850211,513.0305178662088,763.8253201763595,512.0302146385877],[\"Q\",755.8228940676978,511.0299114109665,749.8210744862015,510.0296081833453],[\"Q\",743.8192549047053,509.02930495572417,738.8177385867917,509.02930495572417],[\"Q\",733.8162222688782,509.02930495572417,729.8150092145473,508.029001728103],[\"Q\",725.8137961602165,507.0286985004818,723.813189633051,506.0283952728606],[\"Q\",721.8125831058857,505.0280920452395,719.8119765787203,505.0280920452395],[\"L\",717.8083700515548,505.0280920452395]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":454.23,\"top\":759.6,\"width\":110.04,\"height\":34.02,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",455.728914992885,795.1190280553795],[\"Q\",455.731914992885,795.1160280553795,457.7325215200504,794.1157248277584],[\"Q\",459.7331280472158,793.1154216001372,467.7355541558775,790.1145119172736],[\"Q\",475.7379802645392,787.1136022344101,488.7419226911144,782.1120860963042],[\"Q\",501.7458651176896,777.1105699581984,512.7492010170995,773.1093570477137],[\"Q\",523.7525369165093,769.108144137229,533.7555695523363,767.1075376819867],[\"Q\",543.7586021881634,765.1069312267443,554.7619380875733,763.1063247715019],[\"L\",565.7682739869831,761.1027183162596]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":710.31,\"top\":697.58,\"width\":106.04,\"height\":30.02,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",711.8065504700586,729.0990150323821],[\"Q\",711.8095504700586,729.0960150323821,712.8098537336414,729.0960150323821],[\"Q\",713.810156997224,729.0960150323821,715.8107635243894,728.0957118047609],[\"Q\",717.8113700515548,727.0954085771398,734.8165255324609,720.0932859837916],[\"Q\",751.821681013367,713.0911633904434,762.8250169127768,710.0902537075799],[\"Q\",773.8283528121866,707.0893440247163,782.8310821844309,705.088737569474],[\"Q\",791.8338115566753,703.0881311142316,798.8359344017542,702.0878278866105],[\"Q\",805.8380572468333,701.0875246589893,811.8398768283296,700.0872214313681],[\"L\",817.8446964098258,699.0839182037469]]},{\"type\":\"path\",\"version\":\"5.3.0\",\"originX\":\"left\",\"originY\":\"top\",\"left\":572.26,\"top\":879.64,\"width\":186.06,\"height\":118.04,\"fill\":null,\"stroke\":\"#000000\",\"strokeWidth\":3,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"round\",\"strokeUniform\":false,\"strokeMiterLimit\":10,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"backgroundColor\":\"\",\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"selectable\":true,\"hasControls\":true,\"path\":[[\"M\",759.8241071220286,881.1391056308003],[\"Q\",759.8241071220286,881.1421056308003,759.8241071220286,882.1424088584215],[\"Q\",759.8241071220286,883.1427120860427,759.8241071220286,886.1436217689062],[\"Q\",759.8241071220286,889.1445314517697,759.8241071220286,894.1460475898756],[\"Q\",759.8241071220286,899.1475637279815,758.8238038584459,904.1490798660873],[\"Q\",757.8235005948633,909.1505960041932,756.8231973312805,916.1527185975414],[\"Q\",755.8228940676978,923.1548411908896,753.8222875405324,929.1566605566165],[\"Q\",751.821681013367,935.1584799223436,750.8213777497842,939.1596928328283],[\"Q\",749.8210744862016,943.160905743313,748.8207712226189,947.1621186537977],[\"Q\",747.8204679590361,951.1633315642824,745.8198614318708,954.1642412471459],[\"Q\",743.8192549047053,957.1651509300094,741.8186483775398,960.166060612873],[\"Q\",739.8180418503745,963.1669702957365,737.8174353232091,967.1681832062212],[\"Q\",735.8168287960436,971.1693961167059,732.8159190052954,974.1703057995694],[\"Q\",729.8150092145473,977.1712154824329,726.8140994237992,980.1721251652964],[\"Q\",723.8131896330511,983.1730348481599,720.812279842303,986.1739445310234],[\"Q\",717.8113700515548,989.174854213887,713.810156997224,991.1754606691293],[\"Q\",709.8089439428932,993.1760671243717,705.8077308885623,995.1766735796141],[\"Q\",701.8065178342315,997.1772800348564,697.8053047799007,998.1775832624776],[\"Q\",693.8040917255698,999.1778864900987,689.802878671239,999.1778864900987],[\"Q\",685.8016656169082,999.1778864900987,680.8001492989946,999.1778864900987],[\"Q\",675.798632981081,999.1778864900987,670.7971166631676,999.1778864900987],[\"Q\",665.795600345254,999.1778864900987,661.7943872909232,999.1778864900987],[\"Q\",657.7931742365923,999.1778864900987,653.7919611822615,999.1778864900987],[\"Q\",649.7907481279307,999.1778864900987,645.7895350735998,999.1778864900987],[\"Q\",641.7883220192689,999.1778864900987,638.7874122285208,998.1775832624776],[\"Q\",635.7865024377727,997.1772800348564,632.7855926470245,996.1769768072352],[\"Q\",629.7846828562764,995.176673579614,626.7837730655283,994.1763703519928],[\"Q\",623.7828632747802,993.1760671243717,619.7816502204494,992.1757638967505],[\"Q\",615.7804371661185,991.1754606691293,611.7792241117877,989.1748542138869],[\"Q\",607.7780110574569,987.1742477586446,603.776798003126,985.1736413034023],[\"Q\",599.7755849487952,983.1730348481599,596.7746751580471,980.1721251652964],[\"Q\",593.7737653672989,977.1712154824329,589.7725523129681,974.1703057995694],[\"Q\",585.7713392586372,971.1693961167059,582.770429467889,969.1687896614635],[\"Q\",579.7695196771409,967.1681832062212,578.7692164135583,965.1675767509789],[\"Q\",577.7689131499756,963.1669702957365,575.7683066228101,961.1663638404941],[\"L\",573.7647000956447,959.1627573852518]]}]}";
      var canvasImage = "canvas.png";
      var fallbackImage = null;
      var fabricCanvas = null, saveTimer = null;
      var originalW = 600, originalH = 800; // defaults
      var editor = document.getElementById('editor');
      var saveStatus = document.getElementById('saveStatus');
      
      try { var saved = localStorage.getItem(STORAGE_KEY); if (saved) { var data = JSON.parse(saved); if (data.content) editor.value = data.content; } } catch(e){}
      
      function scheduleSave() {
        if (saveTimer) clearTimeout(saveTimer);
        saveTimer = setTimeout(function() {
          try { localStorage.setItem(STORAGE_KEY, JSON.stringify({ content: editor.value })); saveStatus.textContent = 'saved'; } catch(e){}
        }, 1000);
      }
      editor.addEventListener('input', function() { saveStatus.textContent = 'modified'; scheduleSave(); });
      
      function scaleCanvasToFit() {
        var container = document.getElementById('canvasContainer');
        var wrapper = document.getElementById('canvasWrapper');
        var rect = container.getBoundingClientRect();
        var containerW = rect.width - 20;
        var containerH = rect.height - 20;
        
        if (containerW <= 0 || containerH <= 0) return;
        
        var scaleX = containerW / originalW;
        var scaleY = containerH / originalH;
        var scale = Math.min(scaleX, scaleY, 1); // never scale up beyond 1
        
        wrapper.style.transform = 'scale(' + scale + ')';
      }
      
      function initCanvas() {
        // Get original dimensions from JSON if available
        if (canvasJson) {
          originalW = canvasJson.width || 600;
          originalH = canvasJson.height || 800;
        }
        
        var el = document.getElementById('fabricCanvas');
        el.width = originalW;
        el.height = originalH;
        
        fabricCanvas = new fabric.Canvas('fabricCanvas', { 
          width: originalW, 
          height: originalH, 
          backgroundColor: null 
        });
        fabricCanvas.freeDrawingBrush.width = 3;
        fabricCanvas.freeDrawingBrush.color = '#000000';
        
        if (canvasJson) {
          fabricCanvas.loadFromJSON(canvasJson, function() {
            fabricCanvas.renderAll();
            scaleCanvasToFit();
          });
        } else if (canvasImage || fallbackImage) {
          fabric.Image.fromURL(canvasImage || fallbackImage, function(img) {
            if (!img) return;
            img.set({ left: 0, top: 0, selectable: true });
            fabricCanvas.add(img);
            fabricCanvas.renderAll();
            scaleCanvasToFit();
          }, null, { crossOrigin: 'anonymous' });
        } else {
          scaleCanvasToFit();
        }
      }
      
      document.getElementById('selectBtn').onclick = function() { 
        if(fabricCanvas) { 
          fabricCanvas.isDrawingMode = false; 
          this.classList.add('active'); 
          document.getElementById('drawBtn').classList.remove('active'); 
        } 
      };
      document.getElementById('drawBtn').onclick = function() { 
        if(fabricCanvas) { 
          fabricCanvas.isDrawingMode = true; 
          this.classList.add('active'); 
          document.getElementById('selectBtn').classList.remove('active'); 
        } 
      };
      
      setTimeout(initCanvas, 150);
      
      window.addEventListener('resize', function() {
        scaleCanvasToFit();
      });
    })();
  </script>
</body>
</html>